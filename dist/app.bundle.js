/*! For license information please see app.bundle.js.LICENSE.txt */
(()=>{var t={"./node_modules/seedrandom/index.js":(t,e,n)=>{var i=n("./node_modules/seedrandom/lib/alea.js"),r=n("./node_modules/seedrandom/lib/xor128.js"),s=n("./node_modules/seedrandom/lib/xorwow.js"),o=n("./node_modules/seedrandom/lib/xorshift7.js"),a=n("./node_modules/seedrandom/lib/xor4096.js"),c=n("./node_modules/seedrandom/lib/tychei.js"),l=n("./node_modules/seedrandom/seedrandom.js");l.alea=i,l.xor128=r,l.xorwow=s,l.xorshift7=o,l.xor4096=a,l.tychei=c,t.exports=l},"./node_modules/seedrandom/lib/alea.js":function(t,e,n){var i;!function(t,r,s){function o(t){var e=this,n=function(){var t=4022871197,e=function(e){e=String(e);for(var n=0;n<e.length;n++){var i=.02519603282416938*(t+=e.charCodeAt(n));i-=t=i>>>0,t=(i*=t)>>>0,t+=4294967296*(i-=t)}return 2.3283064365386963e-10*(t>>>0)};return e}();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function a(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function c(t,e){var n=new o(t),i=e&&e.state,r=n.next;return r.int32=function(){return 4294967296*n.next()|0},r.double=function(){return r()+11102230246251565e-32*(2097152*r()|0)},r.quick=r,i&&("object"==typeof i&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=c:n.amdD&&n.amdO?void 0===(i=function(){return c}.call(e,n,e,r))||(r.exports=i):this.alea=c}(0,t=n.nmd(t),n.amdD)},"./node_modules/seedrandom/lib/tychei.js":function(t,e,n){var i;!function(t,r,s){function o(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,i=e.d,r=e.a;return t=t<<25^t>>>7^n,n=n-i|0,i=i<<24^i>>>8^r,r=r-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-i|0,e.d=i<<16^n>>>16^r,e.a=r-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var i=0;i<n.length+20;i++)e.b^=0|n.charCodeAt(i),e.next()}function a(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function c(t,e){var n=new o(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=c:n.amdD&&n.amdO?void 0===(i=function(){return c}.call(e,n,e,r))||(r.exports=i):this.tychei=c}(0,t=n.nmd(t),n.amdD)},"./node_modules/seedrandom/lib/xor128.js":function(t,e,n){var i;!function(t,r,s){function o(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var i=0;i<n.length+64;i++)e.x^=0|n.charCodeAt(i),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function c(t,e){var n=new o(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=c:n.amdD&&n.amdO?void 0===(i=function(){return c}.call(e,n,e,r))||(r.exports=i):this.xor128=c}(0,t=n.nmd(t),n.amdD)},"./node_modules/seedrandom/lib/xor4096.js":function(t,e,n){var i;!function(t,r,s){function o(t){var e=this;e.next=function(){var t,n,i=e.w,r=e.X,s=e.i;return e.w=i=i+1640531527|0,n=r[s+34&127],t=r[s=s+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=r[s]=n^t,e.i=s,n+(i^i>>>16)|0},function(t,e){var n,i,r,s,o,a=[],c=128;for(e===(0|e)?(i=e,e=null):(e+="\0",i=0,c=Math.max(c,e.length)),r=0,s=-32;s<c;++s)e&&(i^=e.charCodeAt((s+32)%e.length)),0===s&&(o=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,s>=0&&(o=o+1640531527|0,r=0==(n=a[127&s]^=i+o)?r+1:0);for(r>=128&&(a[127&(e&&e.length||0)]=-1),r=127,s=512;s>0;--s)i=a[r+34&127],n=a[r=r+1&127],i^=i<<13,n^=n<<17,i^=i>>>15,n^=n>>>12,a[r]=i^n;t.w=o,t.X=a,t.i=r}(e,t)}function a(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function c(t,e){null==t&&(t=+new Date);var n=new o(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&(i.X&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=c:n.amdD&&n.amdO?void 0===(i=function(){return c}.call(e,n,e,r))||(r.exports=i):this.xor4096=c}(0,t=n.nmd(t),n.amdD)},"./node_modules/seedrandom/lib/xorshift7.js":function(t,e,n){var i;!function(t,r,s){function o(t){var e=this;e.next=function(){var t,n,i=e.x,r=e.i;return t=i[r],n=(t^=t>>>7)^t<<24,n^=(t=i[r+1&7])^t>>>10,n^=(t=i[r+3&7])^t>>>3,n^=(t=i[r+4&7])^t<<7,t=i[r+7&7],n^=(t^=t<<13)^t<<9,i[r]=n,e.i=r+1&7,n},function(t,e){var n,i=[];if(e===(0|e))i[0]=e;else for(e=""+e,n=0;n<e.length;++n)i[7&n]=i[7&n]<<15^e.charCodeAt(n)+i[n+1&7]<<13;for(;i.length<8;)i.push(0);for(n=0;n<8&&0===i[n];++n);for(8==n?i[7]=-1:i[n],t.x=i,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function a(t,e){return e.x=t.x.slice(),e.i=t.i,e}function c(t,e){null==t&&(t=+new Date);var n=new o(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&(i.x&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=c:n.amdD&&n.amdO?void 0===(i=function(){return c}.call(e,n,e,r))||(r.exports=i):this.xorshift7=c}(0,t=n.nmd(t),n.amdD)},"./node_modules/seedrandom/lib/xorwow.js":function(t,e,n){var i;!function(t,r,s){function o(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var i=0;i<n.length+64;i++)e.x^=0|n.charCodeAt(i),i==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function c(t,e){var n=new o(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=c:n.amdD&&n.amdO?void 0===(i=function(){return c}.call(e,n,e,r))||(r.exports=i):this.xorwow=c}(0,t=n.nmd(t),n.amdD)},"./node_modules/seedrandom/seedrandom.js":function(t,e,n){var i;!function(r,s,o){var a,c=256,l=o.pow(c,6),u=o.pow(2,52),d=2*u,h=c-1;function f(t,e,n){var i=[],h=y(m((e=1==e?{entropy:!0}:e||{}).entropy?[t,_(s)]:null==t?function(){try{var t;return a&&(t=a.randomBytes)?t=t(c):(t=new Uint8Array(c),(r.crypto||r.msCrypto).getRandomValues(t)),_(t)}catch(t){var e=r.navigator,n=e&&e.plugins;return[+new Date,r,n,r.screen,_(s)]}}():t,3),i),f=new p(i),v=function(){for(var t=f.g(6),e=l,n=0;t<u;)t=(t+n)*c,e*=c,n=f.g(1);for(;t>=d;)t/=2,e/=2,n>>>=1;return(t+n)/e};return v.int32=function(){return 0|f.g(4)},v.quick=function(){return f.g(4)/4294967296},v.double=v,y(_(f.S),s),(e.pass||n||function(t,e,n,i){return i&&(i.S&&g(i,f),t.state=function(){return g(f,{})}),n?(o.random=t,e):t})(v,h,"global"in e?e.global:this==o,e.state)}function p(t){var e,n=t.length,i=this,r=0,s=i.i=i.j=0,o=i.S=[];for(n||(t=[n++]);r<c;)o[r]=r++;for(r=0;r<c;r++)o[r]=o[s=h&s+t[r%n]+(e=o[r])],o[s]=e;(i.g=function(t){for(var e,n=0,r=i.i,s=i.j,o=i.S;t--;)e=o[r=h&r+1],n=n*c+o[h&(o[r]=o[s=h&s+e])+(o[s]=e)];return i.i=r,i.j=s,n})(c)}function g(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function m(t,e){var n,i=[],r=typeof t;if(e&&"object"==r)for(n in t)try{i.push(m(t[n],e-1))}catch(t){}return i.length?i:"string"==r?t:t+"\0"}function y(t,e){for(var n,i=t+"",r=0;r<i.length;)e[h&r]=h&(n^=19*e[h&r])+i.charCodeAt(r++);return _(e)}function _(t){return String.fromCharCode.apply(0,t)}if(y(o.random(),s),t.exports){t.exports=f;try{a=n("?d4c0")}catch(t){}}else void 0===(i=function(){return f}.call(e,n,e,t))||(t.exports=i)}("undefined"!=typeof self?self:this,[],Math)},"./src/effect/attribute.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{Attribute:()=>c,AttributeModifier:()=>u,AttributeModifierType:()=>i,AttributeRegistry:()=>l});var i,r=n("./src/utils/network.ts"),s=n("./src/utils/simpleRegistry.ts"),o=n("./node_modules/js-yaml/dist/js-yaml.mjs"),a=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))};class c{constructor(t,e,n=-1/0,i=1/0){this._id=t,this._baseValue=e,this._minValue=n,this._maxValue=i}get id(){return this._id}get baseValue(){return this._baseValue}get minValue(){return this._minValue}get maxValue(){return this._maxValue}}class l extends s.SimpleRegistry{get name(){return"attributes"}loadAttributes(t){return a(this,void 0,void 0,(function*(){let e=yield(0,r.downloadAndParse)(t,o.load);if(null==e)return;if(!("attributes"in e)||!Array.isArray(e.attributes))throw new Error("Expect an array of attribute definitions.");const n=e.attributes;for(let t of n){if(!("id"in t)||"string"!=typeof t.id)throw new Error("Missing valid attribute id definition.");const e=t.id;if(!("baseValue"in t)||"number"!=typeof t.baseValue)throw new Error("Missing valid base value definition.");const n=t.baseValue;let i=-1/0;if("minValue"in t){if("number"!=typeof t.minValue||isNaN(t.minValue))throw new Error("minValue must be a valid number.");i=t.minValue}let r=1/0;if("maxValue"in t){if("number"!=typeof t.maxValue||isNaN(t.maxValue))throw new Error("maxValue must be a valid number.");r=t.maxValue}this.add(new c(e,n,i,r))}console.log(`Successfully registered ${n.length} attributes.`)}))}}!function(t){t[t.Absolute=0]="Absolute",t[t.Relative=1]="Relative",t[t.RelativeToBase=2]="RelativeToBase"}(i||(i={}));class u{constructor(t,e,n){this._target=t,this._type=e,this._amount=n}get target(){return this._target}get type(){return this._type}get amount(){return this._amount}static fromObject(t,e){if(!("target"in t)||"string"!=typeof t.target)throw new Error("Expect `target` to be a valid string.");const n=t.target;if(!e.has(n))throw new Error(`Attribute "${n}" does not exist.`);if(!("type"in t)||"string"!=typeof t.type)throw new Error("Expect `type` to be a string.");let r=i.Absolute;switch(t.type){case i[i.Absolute]:r=i.Absolute;break;case i[i.Relative]:r=i.Relative;break;case i[i.RelativeToBase]:r=i.RelativeToBase;break;default:throw new Error(`Unknown attribute modifier type: ${t.type}.`)}if(!("amount"in t)||"number"!=typeof t.amount||isNaN(t.amount))throw new Error("Expect `amount` to be a valid number.");return new u(n,r,t.amount)}static CalculateAttributeValue(t,e){let n=t.baseValue;return n*=1+e.relativeToBase,n+=e.absolute,n*=1+e.relative,Math.max(Math.min(n,t.maxValue),t.minValue)}}},"./src/effect/effect.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{EffectProviderCollection:()=>o,EffectProviderCollectionChangedEvent:()=>s,loadEffectsFromObjectArray:()=>r});var i=n("./src/effect/attribute.ts");function r(t,e){let n=[];for(const r of t){if(!("attributeModifiers"in r))continue;if(!Array.isArray(r.attributeModifiers))throw new Error("Expect `attributeModifiers` to be an array.");let t=[];for(const n of r.attributeModifiers)t.push(i.AttributeModifier.fromObject(n,e));n.push({attributeModifiers:t})}return n}class s{constructor(t,e,n,i){this.clear=t,this.item=e,this.oldCount=n,this.newCount=i}}class o{constructor(t){this._items={},this._registry=t}get maxStackSize(){return 1/0}get items(){return this._items}add(t,e=1){if("string"==typeof t&&(t=this._registry.get(t)),e<0||Math.floor(e)!==e)throw new Error("Count must be a positive integer.");if(null==this._items[t.id])this._items[t.id]=[t,e],this.dispatchChangeEvent(new s(!1,t,0,e));else{let n=this._items[t.id][1];this._items[t.id][1]+=e,this._items[t.id][1]>this.maxStackSize&&(this._items[t.id][1]=this.maxStackSize),this.dispatchChangeEvent(new s(!1,t,this._items[t.id][1],n))}}remove(t,e=1){if("string"==typeof t&&(t=this._registry.get(t)),e<0||Math.floor(e)!==e)throw new Error("Count must be a positive integer.");if(null==this._items[t.id])return;let n=this._items[t.id][1];this._items[t.id][1]-=e,this._items[t.id][1]<=0?(delete this._items[t.id],this.dispatchChangeEvent(new s(!1,t,0,n))):this.dispatchChangeEvent(new s(!1,t,this._items[t.id][1],n))}clear(){this.dispatchChangeEvent(new s(!0,void 0,0,0)),this._items={}}count(t){return"string"==typeof t&&(t=this._registry.get(t)),this._items[t.id]?this.items[t.id][1]:0}getCombinedAttributeModifierAmountsOf(t){let e=0,n=0,r=0;for(const s in this._items){const o=this._items[s][0].getEffects();for(const s of o)for(const o of s.attributeModifiers)if(o.target===t.id)switch(o.type){case i.AttributeModifierType.Absolute:e+=o.amount;break;case i.AttributeModifierType.Relative:n+=o.amount;break;case i.AttributeModifierType.RelativeToBase:r+=o.amount}}return{absolute:e,relative:n,relativeToBase:r}}dispatchChangeEvent(t){this.onChanged&&this.onChanged(this,t)}}},"./src/effect/item.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{Inventory:()=>u,Item:()=>c,ItemRegistry:()=>l});var i=n("./src/effect/effect.ts"),r=n("./src/utils/network.ts"),s=n("./node_modules/js-yaml/dist/js-yaml.mjs"),o=n("./src/utils/simpleRegistry.ts"),a=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))};class c{constructor(t,e,n="",i=[]){this._id=t,this._rarity=e,this._icon=n,this._effects=i}get id(){return this._id}get unlocalizedName(){return"item."+this.id}get unlocalizedDescription(){return this.unlocalizedName+".description"}get rarity(){return this._rarity}get icon(){return this._icon}getEffects(){return this._effects}}class l extends o.SimpleRegistry{constructor(t){super(),this._attributeRegistry=t}get name(){return"items"}loadItems(t){return a(this,void 0,void 0,(function*(){let e=yield(0,r.downloadAndParse)(t,s.load);if(!e)return;if(!Array.isArray(e.items))throw new Error("Expecting an array of item definitions.");let n=e.items;for(let t of n){if("string"!=typeof t.id)throw new Error("Missing item id.");let e;e=Array.isArray(t.effects)?(0,i.loadEffectsFromObjectArray)(t.effects,this._attributeRegistry):[];let n="number"==typeof t.rarity?t.rarity:0,r="string"==typeof t.icon?t.icon:"";this.add(new c(t.id,n,r,e))}console.log(`Successfully registered ${n.length} items.`)}))}}class u extends i.EffectProviderCollection{decodeFromJson(t){if(null===t||!Array.isArray(t))throw new Error("Array expected.");this.clear();for(const e of t){if(!Array.isArray(e)||2!==e.length||"string"!=typeof e[0]||"number"!=typeof e[1])throw new Error("Each saved item data should be a two-element tuple of the item id string and the amount number.");this.add(e[0],e[1])}}encodeAsJson(){let t=new Array;for(const e in this._items)t.push([e,this._items[e][1]]);return t}}},"./src/effect/status.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{Status:()=>c,StatusRegistry:()=>l,StatusTable:()=>u});var i=n("./src/effect/effect.ts"),r=n("./node_modules/js-yaml/dist/js-yaml.mjs"),s=n("./src/utils/network.ts"),o=n("./src/utils/simpleRegistry.ts"),a=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))};class c{constructor(t,e,n="",i=[]){this._id=t,this._duration=e,this._icon=n,this._effects=i}get id(){return this._id}get unlocalizedName(){return"status."+this.id}get unlocalizedDescription(){return this.unlocalizedName+".description"}get icon(){return this._icon}get duration(){return this._duration}getEffects(){return this._effects}}class l extends o.SimpleRegistry{constructor(t){super(),this._attributeRegistry=t}get name(){return"status"}loadStatus(t){return a(this,void 0,void 0,(function*(){let e=yield(0,s.downloadAndParse)(t,r.load);if(!e)return;if(!Array.isArray(e.status))throw new Error("Expecting an array of status definitions.");let n=e.status;for(let t of n){if("string"!=typeof t.id)throw new Error("Missing item id.");let e;e=Array.isArray(t.effects)?(0,i.loadEffectsFromObjectArray)(t.effects,this._attributeRegistry):[];let n="number"==typeof t.duration?t.duration:1/0,r="string"==typeof t.icon?t.icon:"";this.add(new c(t.id,n,r,e))}console.log(`Successfully registered ${n.length} status.`)}))}}class u extends i.EffectProviderCollection{constructor(){super(...arguments),this._remainingTicks={}}add(t,e=1){if("string"==typeof t&&(t=this._registry.get(t)),1!==e)throw new Error("Count must be one.");null==this._items[t.id]&&(this._items[t.id]=[t,1],this._remainingTicks[t.id]=t.duration,this.dispatchChangeEvent(new i.EffectProviderCollectionChangedEvent(!1,t,0,1))),this._remainingTicks[t.id]=t.duration}remove(t,e=1){if("string"==typeof t&&(t=this._registry.get(t)),1!==e)throw new Error("Count must be one.");null!=this._items[t.id]&&(delete this._items[t.id],delete this._remainingTicks[t.id],this.dispatchChangeEvent(new i.EffectProviderCollectionChangedEvent(!1,t,0,1)))}clear(){super.clear(),this._remainingTicks={}}tick(){let t=[];for(let e in this._remainingTicks)--this._remainingTicks[e],0===this._remainingTicks[e]&&t.push(e);for(let e of t)this.remove(e)}decodeFromJson(t){if(null===t||!Array.isArray(t))throw new Error("Array expected.");this.clear();for(const e of t){if(!Array.isArray(e)||2!==e.length||"string"!=typeof e[0]||"number"!=typeof e[1])throw new Error("Each saved status data should be a two-element tuple of the status id string and the duration remaining.");const[t,n]=e;this.add(t),this._remainingTicks[t]=n<0?1/0:n}}encodeAsJson(){let t=new Array;for(const e in this._items){const n=this._remainingTicks[e];t.push([e,isFinite(n)?n:-1])}return t}}},"./src/endGameState.ts":(t,e,n)=>{"use strict";var i;n.r(e),n.d(e,{EndGameState:()=>i}),function(t){t[t.None=0]="None",t[t.Win=1]="Win",t[t.Loss=2]="Loss"}(i||(i={}))},"./src/event/actions.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{EACoinFlip:()=>p,EADisableEvents:()=>C,EADisplayChoices:()=>h,EADisplayMessage:()=>u,EADisplayRandomMessage:()=>d,EAEnableEvents:()=>S,EAEndGame:()=>x,EAGiveItem:()=>b,EALog:()=>l,EALoop:()=>m,EARandom:()=>f,EASetStatus:()=>E,EASwitch:()=>g,EATriggerEvents:()=>A,EAUpdateItemAmounts:()=>w,EAUpdateVariable:()=>y,EAUpdateVariableLimits:()=>v,EAUpdateVariables:()=>_,EventActionFactory:()=>c});var i=n("./src/event/core.ts"),r=n("./src/utils/random.ts"),s=n("./src/utils/collection.ts"),o=n("./src/endGameState.ts"),a=n("./src/event/translationKeySource.ts");class c{constructor(t,e){this._deserializers=new Map,this._deserializationContext={actionFactory:this,conditionFactory:t,translationKeySourceFactory:new a.TranslationKeySourceFactory(t,e),expressionCompiler:e}}registerDeserializer(t){this._deserializers.set(t.ID,t.fromJSONObject)}fromJSONObject(t){if(!t.id)throw new Error("Action id is not specified.");const e=t.id;if("string"!=typeof e)throw new Error("Action id must be a string.");const n=this._deserializers.get(e);if(null==n)throw new Error(`No deserializer defined for "${e}".`);return n(t,this._deserializationContext)}fromJSONArray(t){let e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=this.fromJSONObject(t[n]);return e}}class l extends i.EventAction{constructor(t,e){super(),this._message=t,this._dumpVariables=e}static fromJSONObject(t,e){if(null==t.message)throw new Error("Message missing.");return new l(t.message,t.dumpVariables||!1)}execute(t){return console.log(this._message),this._dumpVariables&&t.variableStore.dumpToConsole(),i.EventActionResult.Ok}}l.ID="Log";class u extends i.EventAction{constructor(t,e,n){super(),this._message=t,this._confirm=e,this._icon=n}static fromJSONObject(t,e){if(null==t.message)throw new Error("Message missing.");if(null==t.confirm)throw new Error("Confirm message missing.");return new u(e.translationKeySourceFactory.fromObject(t.message),e.translationKeySourceFactory.fromObject(t.confirm),t.icon||"")}execute(t){return t.actionProxy.displayMessage(this._message.getTranslationKey(t),this._confirm.getTranslationKey(t),this._icon).then((()=>i.EventActionResult.Ok))}collectTranslationKeys(){const t=new s.SetBuilder;return t.addAll(this._message.collectTranslationKeys()),t.addAll(this._confirm.collectTranslationKeys()),t.get()}}u.ID="DisplayMessage";class d extends i.EventAction{constructor(t,e,n){super(),this._messages=t,this._confirm=e,this._icon=n}static fromJSONObject(t,e){if(!Array.isArray(t.messages))throw new Error("Messages missing.");let n=[];for(const i of t.messages)n.push(e.translationKeySourceFactory.fromObject(i));if("string"!=typeof t.confirm)throw new Error("Confirm message missing.");return new d(n,e.translationKeySourceFactory.fromObject(t.confirm),t.icon||"")}execute(t){const e=Math.floor(t.random.next()*this._messages.length);return t.actionProxy.displayMessage(this._messages[e].getTranslationKey(t),this._confirm.getTranslationKey(t),this._icon).then((()=>i.EventActionResult.Ok))}collectTranslationKeys(){const t=new s.SetBuilder(this._confirm.collectTranslationKeys());for(const e of this._messages)t.addAll(e.collectTranslationKeys());return t.get()}}d.ID="DisplayRandomMessage";class h extends i.EventAction{constructor(t,e,n,i,r){if(super(),this._message=t,this._choiceMessages=e,this._requirements=n,this._actions=i,this._icon=r,e.length!==n.length||e.length!==i.length)throw new Error("The number of choices must be equal to the number of requirements/actions.")}static fromJSONObject(t,e){if(null==t.message)throw new Error("Message missing.");const n=e.translationKeySourceFactory.fromObject(t.message);if(!Array.isArray(t.choices))throw new Error("Choices are missing.");let r=[],s=[],o=[];for(const n of t.choices){r.push(e.translationKeySourceFactory.fromObject(n.message));const t=Array.isArray(n.actions)?e.actionFactory.fromJSONArray(n.actions):[];o.push(new i.EventActionList(t)),null!=n.requirement?s.push(e.expressionCompiler.compile(n.requirement)):s.push(e.expressionCompiler.compile("true"))}return new h(n,r,s,o,t.icon||"")}execute(t){let e=[];for(let n=0;n<this._choiceMessages.length;n++)t.evaluator.eval(this._requirements[n])&&e.push([this._choiceMessages[n].getTranslationKey(t),n]);return t.actionProxy.displayChoices(this._message.getTranslationKey(t),e,this._icon).then((e=>this._actions[e].execute(t)))}collectTranslationKeys(){const t=new s.SetBuilder;t.addAll(this._message.collectTranslationKeys());for(const e of this._choiceMessages)t.addAll(e.collectTranslationKeys());for(const e of this._actions)t.addAll(e.collectTranslationKeys());return t.get()}}h.ID="DisplayChoices";class f extends i.EventAction{constructor(t,e){if(super(),t.length!==e.length)throw new Error("The number of weights must match the number of actions.");this._actions=t,this._weightExprs=e}static fromJSONObject(t,e){if(!Array.isArray(t.groups))throw new Error("Missing group definitions.");let n=[],r=[];for(let s of t.groups){let t=s.weight;if(null==t)throw new Error("Missing weight definition.");if("string"!=typeof t&&"number"!=typeof t)throw new Error("Weight must be a number or an expression.");if(!Array.isArray(s.actions))throw new Error("Missing actions.");n.push(e.expressionCompiler.compile(t)),r.push(new i.EventActionList(e.actionFactory.fromJSONArray(s.actions)))}return new f(r,n)}execute(t){return this._actions[this._randomIndex(t)].execute(t)}collectTranslationKeys(){const t=new s.SetBuilder;for(const e of this._actions)t.addAll(e.collectTranslationKeys());return t.get()}_randomIndex(t){return(0,r.weightedSample)(this._weightExprs.map((e=>t.evaluator.eval(e))),(()=>t.random.next()))}}f.ID="Random";class p extends i.EventAction{constructor(t,e,n){super(),this._p=t,this._successActionList=e,this._failActionList=n}static fromJSONObject(t,e){const n=t.probability;if("string"!=typeof n&&"number"!=typeof n)throw new Error("Probability must be a number of an expression.");let r=Array.isArray(t.success)?e.actionFactory.fromJSONArray(t.success):[],s=Array.isArray(t.fail)?e.actionFactory.fromJSONArray(t.fail):[];return new p(e.expressionCompiler.compile(n),new i.EventActionList(r),new i.EventActionList(s))}execute(t){return this._coinFlip(t)?this._successActionList.execute(t):this._failActionList.execute(t)}collectTranslationKeys(){const t=new s.SetBuilder;return t.addAll(this._successActionList.collectTranslationKeys()),t.addAll(this._failActionList.collectTranslationKeys()),t.get()}_coinFlip(t){const e=t.evaluator.eval(this._p);return!(e<0)&&t.random.next()<e}}p.ID="CoinFlip";class g extends i.EventAction{constructor(t,e){super(),this._conditions=t,this._actions=e}static fromJSONObject(t,e){const n=t.branches;if(!Array.isArray(n))throw new Error("Expecting an array of branches.");let r=[],s=[];for(let t of n){if(null==t.condition)throw new Error("Condition is required.");if(r.push(e.conditionFactory.fromJSON(t.condition)),!Array.isArray(t.actions))throw new Error("Missing actions.");s.push(new i.EventActionList(e.actionFactory.fromJSONArray(t.actions)))}return new g(r,s)}execute(t){for(let e=0;e<this._conditions.length;e++)if(this._conditions[e].check(t))return this._actions[e].execute(t);return i.EventActionResult.Ok}collectTranslationKeys(){const t=new s.SetBuilder;for(const e of this._actions)t.addAll(e.collectTranslationKeys());return t.get()}}g.ID="Switch";class m extends i.EventAction{constructor(t,e,n,i){super(),this._stopCondition=t,this._maxIterations=e,this._checkStopConditionAtEnd=n,this._actions=i,this._i=-1}static fromJSONObject(t,e){let n=null;const r=t.stopCondition;null!=r&&(n=e.conditionFactory.fromJSON(r));let s=t.maxIterations;if(null==s)s=0;else{if("number"!=typeof s)throw new Error("maxIterations needs to be a number.");s=s>0?s:0}let o=t.checkStopConditionAtEnd;if(null==o)o=!1;else if("boolean"!=typeof o)throw new Error("checkStopConditionAtEnd need to be a boolean.");if(!Array.isArray(t.actions))throw new Error("Missing actions.");const a=e.actionFactory.fromJSONArray(t.actions);return new m(n,s,o,new i.EventActionList(a))}execute(t){if(this._i>=0)throw new Error("Already executing.");return this._i=0,this._checkStopConditionAtEnd?this._nextDoWhileIteration(t):this._nextWhileDoIteration(t)}collectTranslationKeys(){const t=new s.SetBuilder;return t.addAll(this._actions.collectTranslationKeys()),t.get()}_nextDoWhileIteration(t){do{const e=this._actions.execute(t);if("number"!=typeof e)return e.then((e=>e===i.EventActionResult.StopExecutionGlobally?(this._i=-1,i.EventActionResult.StopExecutionGlobally):this._maxIterations>0&&++this._i>=this._maxIterations||null!==this._stopCondition&&this._stopCondition.check(t)?(this._i=-1,i.EventActionResult.Ok):this._nextDoWhileIteration(t)));if(e===i.EventActionResult.StopExecutionGlobally)return this._i=-1,i.EventActionResult.StopExecutionGlobally;if(this._maxIterations>0&&++this._i>=this._maxIterations){this._i=-1;break}}while(null===this._stopCondition||!this._stopCondition.check(t));return this._i=-1,i.EventActionResult.Ok}_nextWhileDoIteration(t){for(;null===this._stopCondition||!this._stopCondition.check(t);){const e=this._actions.execute(t);if("number"!=typeof e)return e.then((e=>e===i.EventActionResult.StopExecutionGlobally?(this._i=-1,i.EventActionResult.StopExecutionGlobally):this._maxIterations>0&&++this._i>=this._maxIterations?(this._i=-1,i.EventActionResult.Ok):this._nextWhileDoIteration(t)));if(e===i.EventActionResult.StopExecutionGlobally)return this._i=-1,i.EventActionResult.StopExecutionGlobally;if(this._maxIterations>0&&++this._i>=this._maxIterations){this._i=-1;break}}return this._i=-1,i.EventActionResult.Ok}}m.ID="Loop";class y extends i.EventAction{constructor(t,e){super(),this._varName=t,this._updateExpr=e}static fromJSONObject(t,e){if(!t.variable)throw new Error("Missing variable name.");if(null==t.value)throw new Error("Missing value.");let n=t.value;if("number"!=typeof n&&"string"!=typeof n)throw new Error("Value must be either a number of a string.");return new y(t.variable,e.expressionCompiler.compile(n))}execute(t){return t.variableStore.setVar(this._varName,t.evaluator.eval(this._updateExpr),!1),i.EventActionResult.Ok}}y.ID="UpdateVariable";class _ extends i.EventAction{constructor(t,e){if(super(),this._varNames=t,this._updateExprs=e,t.length!==e.length)throw new Error("The number of variables must be equal to the number of expressions.")}static fromJSONObject(t,e){if(!t.updates)throw new Error("Missing update definitions.");let n=[],i=[];for(let r in t.updates)n.push(r),i.push(e.expressionCompiler.compile(t.updates[r]));return new _(n,i)}execute(t){for(let e=0;e<this._varNames.length;e++)t.variableStore.setVar(this._varNames[e],t.evaluator.eval(this._updateExprs[e]));return i.EventActionResult.Ok}}_.ID="UpdateVariables";class v extends i.EventAction{constructor(t){super(),this._limitsByVarName=t}static fromJSONObject(t,e){if(!t.updates)throw new Error("Missing update definitions.");let n={};for(const e in t.updates){let i=t.updates[e];if(!Array.isArray(i)||2!==i.length||"number"!=typeof i[0]||"number"!=typeof i[1])throw new Error("Limits need to be two-element tuples.");n[e]=i}return new v(n)}execute(t){for(const e in this._limitsByVarName){const n=this._limitsByVarName[e];t.variableStore.setVarLimits(e,n[0],n[1])}return i.EventActionResult.Ok}}v.ID="UpdateVariableLimits";class b extends i.EventAction{constructor(t,e){super(),this._itemId=t,this._amountExpr=e}static fromJSONObject(t,e){if(null==t.itemId)throw new Error("Missing item id.");if("string"!=typeof t.amount&&"number"!=typeof t.amount)throw new Error("Amount must be a number or an expression.");return new b(t.itemId,e.expressionCompiler.compile(t.amount))}execute(t){let e=t.evaluator.eval(this._amountExpr);return e>0?t.inventory.add(this._itemId,e):e<0&&t.inventory.remove(this._itemId,-e),i.EventActionResult.Ok}}b.ID="GiveItem";class w extends i.EventAction{constructor(t,e){if(super(),this._itemIds=t,this._updateExprs=e,t.length!==e.length)throw new Error("The number of items must match the number of expressions.")}static fromJSONObject(t,e){if(null==t.updates)throw new Error("Missing update definitions.");let n=[],i=[];for(const r in t.updates)n.push(r),i.push(e.expressionCompiler.compile(t.updates[r]));return new w(n,i)}execute(t){for(let e=0;e<this._itemIds.length;e++){const n=this._itemIds[e],i=t.evaluator.eval(this._updateExprs[e]);i>0?t.inventory.add(n,i):i<0&&t.inventory.remove(n,-i)}return i.EventActionResult.Ok}}w.ID="UpdateItemAmounts";class x extends i.EventAction{constructor(t,e,n,i,r){super(),this._message=t,this._confirm=e,this._winning=n,this._endingType=i,this._fx=r}static fromJSONObject(t,e){if(null==t.message)throw new Error("Missing message.");if(null==t.confirm)throw new Error("Missing confirm message.");if("boolean"!=typeof t.winning)throw new Error("Missing winning status.");if(t.endingType&&"string"!=typeof t.endingType)throw new Error('"endingType" must be a string if set.');if(t.fx&&"string"!=typeof t.fx)throw new Error("FX must be a string.");return new x(e.translationKeySourceFactory.fromObject(t.message),e.translationKeySourceFactory.fromObject(t.confirm),t.winning,t.endingType,t.fx)}execute(t){return t.actionProxy.displayMessage(this._message.getTranslationKey(t),this._confirm.getTranslationKey(t),"",this._fx).then((()=>(t.setEndGameState(this._winning?o.EndGameState.Win:o.EndGameState.Loss,this._endingType),i.EventActionResult.StopExecutionGlobally)))}collectTranslationKeys(){const t=new s.SetBuilder;return t.addAll(this._message.collectTranslationKeys()),t.addAll(this._confirm.collectTranslationKeys()),t.get()}}x.ID="EndGame";class E extends i.EventAction{constructor(t,e){super(),this._statusId=t,this._on=e}static fromJSONObject(t,e){if("string"!=typeof t.statusId)throw new Error("Missing status id.");if("boolean"!=typeof t.on)throw new Error("Missing on/off indicator.");return new E(t.statusId,t.on)}execute(t){return this._on?t.statusTable.add(this._statusId):t.statusTable.remove(this._statusId),i.EventActionResult.Ok}}E.ID="SetStatus";class A extends i.EventAction{constructor(t){super(),this._triggerInfoList=t}static fromJSONObject(t,e){let n=[];if(!t.triggers||!Array.isArray(t.triggers))throw new Error("Missing trigger definitions.");for(const i of t.triggers){let t=i.id;if("string"!=typeof t)throw new Error("Missing valid trigger id.");let r=i.priority||0;if("number"!=typeof r||isNaN(r))throw new Error("Priority must be a valid number.");let s={id:t,priority:r},o=i.probability;if(null!=o){if("string"!=typeof o&&"number"!=typeof o)throw new Error("Invalid probability definition.");s.probability=e.expressionCompiler.compile(o)}n.push(s)}return new A(n)}execute(t){for(const e of this._triggerInfoList){const n=null==e.probability?1:t.evaluator.eval(e.probability);t.eventEngine.trigger(e.id,n,e.priority)}return i.EventActionResult.Ok}}A.ID="TriggerEvents";class S extends i.EventAction{constructor(t){super(),this._eventIds=t}static fromJSONObject(t,e){if(!("eventIds"in t)||!Array.isArray(t.eventIds))throw new Error('Expecting "eventIds" to be an array.');let n=[];for(let e of t.eventIds){if("string"!=typeof e)throw new Error("Expect event id to be a string.");n.push(e)}return new S(n)}execute(t){for(const e of this._eventIds)t.eventEngine.enableEvent(e);return i.EventActionResult.Ok}}S.ID="EnableEvents";class C extends i.EventAction{constructor(t){super(),this._eventIds=t}static fromJSONObject(t,e){if(!("eventIds"in t)||!Array.isArray(t.eventIds))throw new Error('Expecting "eventIds" to be an array.');let n=[];for(let e of t.eventIds){if("string"!=typeof e)throw new Error("Expect event id to be a string.");n.push(e)}return new C(n)}execute(t){for(const e of this._eventIds)t.eventEngine.disableEvent(e);return i.EventActionResult.Ok}}C.ID="DisableEvents"},"./src/event/conditions.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{ECAll:()=>a,ECAny:()=>c,ECExpression:()=>s,ECNot:()=>o,ECSome:()=>l,EventConditionFactory:()=>r});var i=n("./src/event/core.ts");class r{constructor(t){this._deserializers=new Map,this._deserializationContext={conditionFactory:this,expressionCompiler:t}}registerDeserializer(t){this._deserializers.set(t.ID,t.fromJSONObject)}fromJSONObject(t){if(!("id"in t)||"string"!=typeof t.id)throw new Error("Condition id must be a string.");const e=t.id,n=this._deserializers.get(e);if(null==n)throw new Error(`No deserializer defined for "${e}".`);return n(t,this._deserializationContext)}fromJSON(t){if(null==t)throw new Error("JSON input cannot be null.");if("number"==typeof t||"string"==typeof t)return new s(this._deserializationContext.expressionCompiler.compile(t));if("object"==typeof t)return this.fromJSONObject(t);throw new Error("Unsupported JSON input.")}fromJSONArray(t){return t.map((t=>this.fromJSON(t)))}}class s extends i.EventCondition{constructor(t){super(),this._expression=t}static fromJSONObject(t,e){if(!("expression"in t)||null==t.expression)throw new Error("Missing expression.");const n=t.expression;if("number"!=typeof n&&"string"!=typeof n)throw new Error("Expression must be a number or string.");return new s(e.expressionCompiler.compile(n))}check(t){return!!t.evaluator.eval(this._expression)}}s.ID="Expression";class o extends i.EventCondition{constructor(t){super(),this._condition=t}static fromJSONObject(t,e){if(!("condition"in t)||null==t.condition)throw new Error("Missing condition definition.");return new o(e.conditionFactory.fromJSON(t.condition))}check(t){return!this._condition.check(t)}}o.ID="Not";class a extends i.EventCondition{constructor(t){super(),this._conditions=t}static fromJSONObject(t,e){if(!("conditions"in t)||!Array.isArray(t.conditions))throw new Error("Missing condition definitions.");return new a(e.conditionFactory.fromJSONArray(t.conditions))}check(t){for(let e of this._conditions)if(!e.check(t))return!1;return!0}}a.ID="All";class c extends i.EventCondition{constructor(t){super(),this._conditions=t}static fromJSONObject(t,e){if(!("conditions"in t)||!Array.isArray(t.conditions))throw new Error("Missing condition definitions.");return new c(e.conditionFactory.fromJSONArray(t.conditions))}check(t){for(let e of this._conditions)if(e.check(t))return!0;return!1}}c.ID="Any";class l extends i.EventCondition{constructor(t,e,n){super(),this._conditions=t,this._min=e,this._max=n}static fromJSONObject(t,e){if(!("conditions"in t)||!Array.isArray(t.conditions))throw new Error("Missing condition definitions.");const n=e.conditionFactory.fromJSONArray(t.conditions);let i,r;if("min"in t){if("number"!=typeof t.min&&"string"!=typeof t.min)throw new Error("min must be a valid number or expression string.");i=e.expressionCompiler.compile(t.min)}else i=e.expressionCompiler.compile(-1/0);if("max"in t){if("number"!=typeof t.max&&"string"!=typeof t.max)throw new Error("max must be a valid number or expression string.");r=e.expressionCompiler.compile(t.max)}else r=e.expressionCompiler.compile(1/0);return new l(n,i,r)}check(t){const e=t.evaluator.eval(this._min),n=t.evaluator.eval(this._max);let i=0;for(let e of this._conditions)e.check(t)&&i++;return i>=e&&i<=n}}l.ID="Some"},"./src/event/core.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{EventAction:()=>a,EventActionList:()=>c,EventActionResult:()=>i,EventCondition:()=>s,GameEvent:()=>u});var i,r=n("./src/utils/collection.ts");class s{check(t){throw new Error("Not implemented.")}}!function(t){t[t.Ok=0]="Ok",t[t.StopExecutionLocally=1]="StopExecutionLocally",t[t.StopExecutionGlobally=2]="StopExecutionGlobally"}(i||(i={}));const o=new Set;class a{collectTranslationKeys(){return o}}class c{constructor(t,e=-1){this._actions=t,this._nextIndex=e}get actions(){return this._actions}execute(t){if(this._nextIndex>=0)throw new Error("Already executing.");return this._nextIndex=0,this._executeNext(t)}collectTranslationKeys(){const t=new r.SetBuilder;for(let e of this._actions)t.addAll(e.collectTranslationKeys());return t.get()}_executeNext(t){for(;this._nextIndex>=0&&this._nextIndex<this._actions.length;){const e=this._actions[this._nextIndex];++this._nextIndex;const n=e.execute(t);if("number"!=typeof n)return n.then((e=>e===i.Ok?this._executeNext(t):(this._nextIndex=-1,e===i.StopExecutionLocally?i.Ok:i.StopExecutionGlobally)));if(n!==i.Ok)return this._nextIndex=-1,n===i.StopExecutionLocally?i.Ok:i.StopExecutionGlobally}return this._nextIndex=-1,i.Ok}}const l=new c([]);class u{constructor(t,e,n=[],i=l,r=1,s=[],o=!1,a=!1){this._id=t,this._trigger=e,this._conditions=n,this._actions=i,this._probability=r,this._exclusions=s,this._once=o,this._disabledByDefault=a}get id(){return this._id}get trigger(){return this._trigger}get conditions(){return this._conditions}get actions(){return this._actions}get probability(){return this._probability}get exclusions(){return this._exclusions}get once(){return this._once}get disabledByDefault(){return this._disabledByDefault}collectTranslationKeys(){return this._actions.collectTranslationKeys()}}},"./src/event/engine.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{GameEventEngine:()=>a});var i=n("./src/event/core.ts"),r=n("./src/utils/priorityQueue.ts"),s=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))};function o(t,e){return t.priority!==e.priority?t.priority<e.priority:t.order!==e.order?t.order>e.order:t.id<e.id}class a{constructor(){this._eventsByTrigger=new Map,this._eventInfoById=new Map,this._pendingTriggers=new r.PriorityQueue(o),this._pendingTriggerOrder=0,this._ongoingTrigger=null}enableEvent(t){let e=this._eventInfoById.get(t);if(null==e)throw new Error(`Event "${t}" does not exist.`);e.disabled=!1}disableEvent(t){let e=this._eventInfoById.get(t);if(null==e)throw new Error(`Event "${t}" does not exist.`);e.disabled=!0}registerEvents(t){for(let e of t)this.registerEvent(e)}registerEvent(t){if(this._eventInfoById.has(t.id))throw new Error(`Event "${t.id}" is already registered.`);this._eventInfoById.set(t.id,{event:t,disabled:t.disabledByDefault,occurrenceCount:0});let e=this._eventsByTrigger.get(t.trigger);null==e?this._eventsByTrigger.set(t.trigger,[t]):e.push(t)}unregisterEvent(t){if(!this._eventInfoById.has(t.id))return;this._eventInfoById.delete(t.id);let e=this._eventsByTrigger.get(t.trigger);if(null!=e){const n=e.indexOf(t);if(n>=0)return e.splice(n,1),void(0===e.length&&this._eventsByTrigger.delete(t.trigger))}throw new Error("Invariance broken: event has info entry but not registered under any trigger id.")}getEvents(){let t=[];for(let e of this._eventInfoById.values())t.push(e.event);return t}getEventOccurrenceCount(t){const e=this._eventInfoById.get(t);return null==e?0:e.occurrenceCount}trigger(t,e,n){if(0===t.length)throw new Error("Trigger id cannot be empty.");this._pendingTriggers.push({id:t,priority:n,order:this._pendingTriggerOrder++,probability:e})}processNextTrigger(t){return s(this,void 0,void 0,(function*(){if(this._pendingTriggers.empty())return!1;const e=this._pendingTriggers.pop();if(e.probability<=0||e.probability<1&&t.random.next()>e.probability)return!this._pendingTriggers.empty();if(null!=this._ongoingTrigger)throw new Error(`Cannot process the next trigger when the ongoing trigger "${this._ongoingTrigger}" is still being processed.`);const n=e.id;this._ongoingTrigger=n;const r=this._eventsByTrigger.get(n);if(null==r)return!this._pendingTriggers.empty();let s={};for(let e of r){const n=this._eventInfoById.get(e.id);if(n.disabled)continue;if(s[e.id])continue;let r=!1;for(let n of e.conditions)if(!n.check(t)){r=!0;break}if(r)continue;const o="number"==typeof e.probability?e.probability:t.evaluator.eval(e.probability);if(o<=0||o<1&&t.random.next()>o)continue;for(let t of e.exclusions)s[t]=!0;++n.occurrenceCount;const a=yield e.actions.execute(t);if(e.once&&(n.disabled=!0),a===i.EventActionResult.StopExecutionGlobally)break}return this._ongoingTrigger=null,!this._pendingTriggers.empty()}))}reset(){if(null!=this._ongoingTrigger)throw new Error(`Cannot reset the engine when the ongoing trigger "${this._ongoingTrigger}" is still being processed.`);for(let t of this._eventInfoById.values())t.disabled=t.event.disabledByDefault,t.occurrenceCount=0;this._pendingTriggers.clear(),this._pendingTriggerOrder=0}}},"./src/event/expression.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{EventExpressionEngine:()=>s});var i=n("./src/utils/expression.ts"),r=n("./src/effect/attribute.ts");class s{constructor(t,e,n,i,r,s){this._cache={},this._variableStore=t,this._attributes=e,this._inventory=n,this._statusTable=i,this._random=r,this._eventOccurrenceTracker=s,this._fTable=this._initFunctionTable()}_initFunctionTable(){return{getVar:t=>this._variableStore.getVar(t,!0),setVarLimits:(t,e,n)=>this._variableStore.setVarLimits(t,e,n),eventOccurred:t=>this._eventOccurrenceTracker.getEventOccurrenceCount(t)>0,upperBound:t=>this._variableStore.getVarLimits(t)[1],lowerBound:t=>this._variableStore.getVarLimits(t)[0],itemCount:t=>this._inventory.count(t),totalMonths:()=>12*this._variableStore.getVar("year",!0)+this._variableStore.getVar("month",!0),getAttributeValue:t=>{const e=this._attributes.get(t),n=this._inventory.getCombinedAttributeModifierAmountsOf(e),i=this._statusTable.getCombinedAttributeModifierAmountsOf(e);return r.AttributeModifier.CalculateAttributeValue(e,{absolute:n.absolute+i.absolute,relative:n.relative+i.relative,relativeToBase:n.relativeToBase+i.relativeToBase})},hasStatus:t=>this._statusTable.count(t)>0,random:()=>this._random.next(),randi:t=>Math.floor(this._random.next()*t),max:Math.max,min:Math.min,floor:Math.floor,round:Math.round,ceil:Math.ceil,clip:(t,e,n)=>t<e?t:t>n?n:t}}getClosure(){return this._fTable}existsFunction(t){return null!=this._fTable[t]}compile(t){return"number"==typeof t?{source:t.toString(),fn:()=>t}:(this._cache[t]||(this._cache[t]=(0,i.compileExpression)(t,this)),this._cache[t])}eval(t){let e=t.fn(this.getClosure());if(isNaN(e))throw new Error("Expression produced NaN.");return e}}},"./src/event/loader.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{GameEventLoader:()=>a});var i=n("./src/event/core.ts"),r=n("./src/utils/network.ts"),s=n("./node_modules/js-yaml/dist/js-yaml.mjs"),o=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))};class a{constructor(t,e,n){this._exprCompiler=t,this._conditionFactory=e,this._actionFactory=n}load(t){return o(this,void 0,void 0,(function*(){return(0,r.downloadAndParse)(t,(t=>this.loadFromString(t)))}))}loadFromString(t){return this.parseEvents((0,s.load)(t)||{})}parseEvents(t){if(!Array.isArray(t))throw new Error("Expecting an array of event definitions.");return t.map((t=>this.parseEvent(t)))}parseEvent(t){if(null==t.id)throw new Error("Missing event id.");const e=t.id;if(null!=t.trigger&&"string"!=typeof t.trigger)throw new Error("Event trigger must be a string.");const n=t.trigger||"",r=Array.isArray(t.conditions)?t.conditions.map((t=>this._conditionFactory.fromJSON(t))):[];let s;if(null==t.probability)s=1;else if("number"==typeof t.probability)s=t.probability;else{if("string"!=typeof t.probability)throw new Error("Probability must either a number or a string expression.");s=this._exprCompiler.compile(t.probability)}const o=Array.isArray(t.exclusions)?t.exclusions:[];if(!Array.isArray(t.actions))throw new Error("Missing actions.");const a=new i.EventActionList(t.actions.map((t=>this._actionFactory.fromJSONObject(t)))),c=!!t.once,l=!!t.disabled;return new i.GameEvent(e,n,r,a,s,o,c,l)}}},"./src/event/translationKeySource.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{ConditionalTranslationKeySource:()=>a,ConstantTranslationKeySource:()=>s,RandomTranslationKeySource:()=>o,TranslationKeySourceFactory:()=>c});var i=n("./src/utils/collection.ts"),r=n("./src/utils/random.ts");class s{constructor(t){this._key=t}getTranslationKey(t){return this._key}collectTranslationKeys(){return new Set([this._key])}}class o{constructor(t,e){if(this._keySources=t,this._weights=e,this._keySources.length!==this._weights.length)throw new Error("The number of TranslationKeySources is not equal to the number of weight expressions.");if(0===this._keySources.length)throw new Error("At least one TranslationKeySource is required.")}getTranslationKey(t){const e=this._weights.map((e=>t.evaluator.eval(e))),n=(0,r.weightedSample)(e,(()=>t.random.next()));return this._keySources[n].getTranslationKey(t)}collectTranslationKeys(){const t=new i.SetBuilder;for(const e of this._keySources)t.addAll(e.collectTranslationKeys());return t.get()}}class a{constructor(t,e,n){if(this._defaultKey=t,this._conditions=e,this._keySources=n,this._keySources.length!==this._conditions.length)throw new Error("The number of TranslationKeySources is not equal to the number of conditions.")}getTranslationKey(t){for(let e=0;e<this._conditions.length;e++)if(this._conditions[e].check(t))return this._keySources[e].getTranslationKey(t);return this._defaultKey.getTranslationKey(t)}collectTranslationKeys(){const t=new i.SetBuilder(this._defaultKey.collectTranslationKeys());for(const e of this._keySources)t.addAll(e.collectTranslationKeys());return t.get()}}class c{constructor(t,e){this._conditionFactory=t,this._expressionCompiler=e}fromObject(t){if("string"==typeof t)return new s(t);if(Array.isArray(t)){if(0===t.length)throw new Error("The array of TranslationKeySource definitions cannot be empty.");let e=[],n=[];if("object"==typeof t[0]&&"weight"in t[0]&&"text"in t[0])for(const i of t){const t=i.weight;if(null==t)throw new Error('"weight" is not defined.');if("number"!=typeof t&&"string"!=typeof t)throw new Error("Weight must be a number or a string defining an expression.");n.push(this._expressionCompiler.compile(t));const r=i.text;if(null==r)throw new Error('"text" is not defined.');e.push(this.fromObject(r))}else for(const i of t)e.push(this.fromObject(i)),n.push(this._expressionCompiler.compile(1));return new o(e,n)}if("object"==typeof t&&"default"in t&&"branches"in t){const e=this.fromObject(t.default);if(!Array.isArray(t.branches))throw new Error('"branches" should be an array.');let n=[],i=[];for(const e of t.branches)n.push(this._conditionFactory.fromJSON(e.condition)),i.push(this.fromObject(e.text));return new a(e,n,i)}throw new Error("Unrecognized TranslationKeySource definition.")}}},"./src/gameEngine.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{GameActionProxy:()=>_,GameEndEvent:()=>m,GameEngine:()=>y});var i=n("./src/variableStore.ts"),r=n("./src/effect/item.ts"),s=n("./src/event/engine.ts"),o=n("./src/event/expression.ts"),a=n("./src/event/actions.ts"),c=n("./src/event/conditions.ts"),l=n("./src/event/loader.ts"),u=n("./src/effect/status.ts"),d=n("./src/utils/random.ts"),h=n("./src/endGameState.ts"),f=n("./src/effect/attribute.ts"),p=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))};function g(){return Math.random().toString().substring(2)}class m{constructor(t,e){this.state=t,this.endingType=e}}class y{constructor(t,e){this._dataLoaded=!1,this._config=Object.assign({},t),this._actionProxy=e,this._attributeRegistry=new f.AttributeRegistry,this._itemRegistry=new r.ItemRegistry(this._attributeRegistry),this._statusRegistry=new u.StatusRegistry(this._attributeRegistry),this._inventory=new r.Inventory(this._itemRegistry),this._statusTable=new u.StatusTable(this._statusRegistry),this._variableStore=new i.VariableStore,this._endGameState=h.EndGameState.None,this._endingType="",this._random=new d.AleaRandomSource(null==this._config.initialRandomSeed?g():this._config.initialRandomSeed),this._eventEngine=new s.GameEventEngine,this._expressionEngine=new o.EventExpressionEngine(this._variableStore,this._attributeRegistry,this._inventory,this._statusTable,this._random,this._eventEngine),this._conditionFactory=new c.EventConditionFactory(this._expressionEngine),this._actionFactory=new a.EventActionFactory(this._conditionFactory,this._expressionEngine),this._executionContext={variableStore:this._variableStore,inventory:this._inventory,statusTable:this._statusTable,random:this._random,evaluator:this._expressionEngine,eventEngine:this._eventEngine,actionProxy:e,setEndGameState:(t,e)=>{this._endGameState=t,e&&(this._endingType=e)}}}get variableStore(){return this._variableStore}get random(){return this._random}get attributeRegistry(){return this._attributeRegistry}get itemRegistry(){return this._itemRegistry}get statusRegistry(){return this._statusRegistry}get inventory(){return this._inventory}get statusTable(){return this._statusTable}get actionProxy(){return this._actionProxy}get expressionEngine(){return this._expressionEngine}get eventEngine(){return this._eventEngine}loadGameData(){return p(this,void 0,void 0,(function*(){if(this._dataLoaded)return;this._initFactories(),this._config.attributeDefinitionUrl?yield this._attributeRegistry.loadAttributes(this._config.attributeDefinitionUrl):console.warn("Missing attribute definitions. No attributes loaded."),this._config.itemDefinitionUrl?yield this._itemRegistry.loadItems(this._config.itemDefinitionUrl):console.warn("Missing item definitions. No items loaded."),this._config.statusDefinitionUrl?yield this._statusRegistry.loadStatus(this._config.statusDefinitionUrl):console.warn("Missing status definitions. No status loaded.");const t=new l.GameEventLoader(this._expressionEngine,this._conditionFactory,this._actionFactory);if(this._config.eventDefinitionUrl){const e=yield t.load(this._config.eventDefinitionUrl);this._eventEngine.registerEvents(e),console.log(`Successfully registered ${e.length} game events.`)}else console.warn("Missing event definitions. No events loaded.");this._dataLoaded=!0}))}_initFactories(){this._actionFactory.registerDeserializer(a.EALog),this._actionFactory.registerDeserializer(a.EADisplayMessage),this._actionFactory.registerDeserializer(a.EADisplayRandomMessage),this._actionFactory.registerDeserializer(a.EADisplayChoices),this._actionFactory.registerDeserializer(a.EARandom),this._actionFactory.registerDeserializer(a.EACoinFlip),this._actionFactory.registerDeserializer(a.EAUpdateVariable),this._actionFactory.registerDeserializer(a.EAUpdateVariables),this._actionFactory.registerDeserializer(a.EAUpdateVariableLimits),this._actionFactory.registerDeserializer(a.EAGiveItem),this._actionFactory.registerDeserializer(a.EAUpdateItemAmounts),this._actionFactory.registerDeserializer(a.EAEndGame),this._actionFactory.registerDeserializer(a.EASetStatus),this._actionFactory.registerDeserializer(a.EASwitch),this._actionFactory.registerDeserializer(a.EALoop),this._actionFactory.registerDeserializer(a.EATriggerEvents),this._actionFactory.registerDeserializer(a.EAEnableEvents),this._actionFactory.registerDeserializer(a.EADisableEvents),this._conditionFactory.registerDeserializer(c.ECExpression),this._conditionFactory.registerDeserializer(c.ECNot),this._conditionFactory.registerDeserializer(c.ECAll),this._conditionFactory.registerDeserializer(c.ECAny),this._conditionFactory.registerDeserializer(c.ECSome)}start(t){return p(this,void 0,void 0,(function*(){this._dataLoaded||(yield this.loadGameData()),this._variableStore.reset(),this._inventory.clear(),this._statusTable.clear(),this._endGameState=h.EndGameState.None,t?this._random.reset(g()):this._random.reset(),this._eventEngine.reset(),this._eventEngine.trigger("Initialization",1,0)}))}tick(){return p(this,void 0,void 0,(function*(){for(this._eventEngine.trigger("Tick",1,0);;){const t=yield this._eventEngine.processNextTrigger(this._executionContext);if(this._endGameState!==h.EndGameState.None)return this.onGameEnd&&this.onGameEnd(this,new m(this._endGameState,this._endingType)),void(yield this.start(this._endGameState===h.EndGameState.Win));if(!t)break}this._statusTable.tick()}))}}class _{attachGui(t){this._guiGame=t}displayMessage(t,e,n,i){if(!this._guiGame)throw new Error("No attached GUI.");return this._guiGame.displayMessage(t,e,n,i)}displayChoices(t,e,n){if(!this._guiGame)throw new Error("No attached GUI.");return this._guiGame.displayChoices(t,e,n)}}},"./src/gui/guiBase.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{GuiBase:()=>i});class i{constructor(t,e){this._container=t,this._textEngine=e}setHidden(t){this._container.style.display=t?"none":"block"}removeAllChildrenOf(t){for(;t.firstChild;)t.removeChild(t.firstChild)}createAndAddChild(t,e,n){const i=document.createElement(t);return e&&(i.id=e),n&&(i.className=n),this._container.appendChild(i),i}}},"./src/gui/guiEffectProviderList.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{GuiEffectProviderList:()=>r,GuiItemList:()=>s,GuiStatusList:()=>o});var i=n("./src/gui/guiBase.ts");class r extends i.GuiBase{constructor(t,e,n,i,r){if(super(t,e),this._collection=n,this._registry=i,this._titleContainer=this.createAndAddChild("h3"),r){if("string"!=typeof r.title)throw new Error("Title must be a string.");this._titleContainer.innerHTML=e.localizeAndRender(r.title),e.getLocalizationDictionary().addRequiredKey(r.title)}this._listContainer=this.createAndAddChild("ul"),this._collection.onChanged=(t,e)=>{this.renderList(t,e)},this._listContainer.onclick=t=>{let e=t.target;e instanceof HTMLLIElement&&this.onItemClicked&&this.onItemClicked(this.retrieveEffectProviderFromElement(e))}}}class s extends r{constructor(t,e,n,i,r){if(super(t,e,n,i,r),this._raritySpecificStyles=[],null!=r&&null!=r.raritySpecificStyles){if(!Array.isArray(r.raritySpecificStyles))throw new Error("raritySpecificStyles must be an array.");for(let t of r.raritySpecificStyles){const e=null==t.minRarity?-1/0:t.minRarity,n=null==t.maxRarity?1/0:t.maxRarity;if(!Array.isArray(t.styleClasses))throw new Error("styleClasses must be an array.");for(const e of t.styleClasses)if("string"!=typeof e)throw new Error("styleClasses must be an array of strings.");this._raritySpecificStyles.push({minRarity:e,maxRarity:n,styleClasses:[...t.styleClasses]})}}}renderList(t,e){if(this.removeAllChildrenOf(this._listContainer),!e.clear)for(const e in t.items){let n=document.createElement("li"),[i,r]=t.items[e];n.setAttribute("data-item-id",i.id);for(const t of this._raritySpecificStyles)i.rarity>=t.minRarity&&i.rarity<=t.maxRarity&&n.classList.add(...t.styleClasses);const s=this._textEngine.localizeAndRender(i.unlocalizedName);n.innerHTML=`${s} x${r}`,this._listContainer.appendChild(n)}}retrieveEffectProviderFromElement(t){return this._registry.get(t.getAttribute("data-item-id")||"")}}class o extends r{constructor(t,e,n,i,r){super(t,e,n,i,r)}renderList(t,e){if(this.removeAllChildrenOf(this._listContainer),!e.clear)for(const e in t.items){let n=document.createElement("li"),i=t.items[e];n.innerHTML=this._textEngine.localizeAndRender(i[0].unlocalizedName),n.setAttribute("data-status-id",e),this._listContainer.appendChild(n)}}retrieveEffectProviderFromElement(t){return this._registry.get(t.getAttribute("data-status-id")||"")}}},"./src/gui/guiFooter.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{GuiFooter:()=>r});var i=n("./src/gui/guiBase.ts");class r extends i.GuiBase{constructor(t,e,n,i){if(super(t,e),this.removeAllChildrenOf(t),!i)return;const r=e.getLocalizationDictionary();if(i.preamble){let t=document.createElement("span");t.innerHTML=e.localizeAndRender(i.preamble),r.addRequiredKey(i.preamble),this._container.appendChild(t)}for(let t=0;t<i.buttons.length;t++){const s=i.buttons[t];if(t>0){let t=document.createElement("span");t.textContent=" | ",this._container.appendChild(t)}let o=document.createElement("a");if(o.innerHTML=e.localizeAndRender(s.text),r.addRequiredKey(s.text),"styleClasses"in s){if(!Array.isArray(s.styleClasses))throw new Error("Style classes should be an array.");for(let t of s.styleClasses)o.classList.add(t)}"url"in s?o.href=s.url:(r.addRequiredKey(s.messageTitle),r.addRequiredKey(s.message),r.addRequiredKey(s.confirmText),o.onclick=t=>{t.preventDefault(),n.display(s.messageTitle,s.message,s.confirmText,s.icon)}),this._container.appendChild(o)}}}},"./src/gui/guiFx.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{GuiFX:()=>s});var i=n("./src/gui/guiBase.ts");class r{constructor(t){this.x=0,this.y=0,this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.active=!0,this._el=document.createElement("div"),this._el.className=t}get element(){return this._el}addToScene(t){t.appendChild(this._el)}removeFromScene(t){t.removeChild(this._el)}updatePosition(t){this.active&&(this.vx+=this.ax*t,this.vy+=this.ay*t,this.x+=(this.vx+.5*this.ax*t)*t,this.y+=(this.vy+.5*this.ay*t)*t,this._el.style.top=this.y+"px",this._el.style.left=this.x+"px")}}class s extends i.GuiBase{confetti(){const t=["#f00","#0f0","#00f","#ff0","#0ff","#f0f","#000","#fff"];let e=[],n=this._container.offsetWidth,i=document.body.offsetHeight,s=Math.max(30,Math.ceil(n/20)),o=null;for(let i=0;i<s;i++){let i=new r("particle_confetti");i.x=Math.random()*n,i.y=-10-300*Math.random(),i.vy=2*Math.random(),i.ay=8/60,i.element.style.backgroundColor=t[Math.floor(Math.random()*t.length)],i.element.style.width=Math.floor(6*Math.random()+4)+"px",i.element.style.height=i.element.style.width,i.addToScene(this._container),e.push(i)}const a=t=>{o||(o=t);let n=(t-o)/(1e3/60);o=t;for(let t of e)t.updatePosition(n),t.active&&t.y>1.5*i&&(t.active=!1,t.removeFromScene(this._container),s--);s>0&&requestAnimationFrame(a)};requestAnimationFrame(a)}}},"./src/gui/guiGame.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{GuiGameWindow:()=>u});var i=n("./src/gui/guiModalBox.ts"),r=n("./src/gui/guiBase.ts"),s=n("./src/gui/guiMessageWindow.ts"),o=n("./src/gui/guiEffectProviderList.ts"),a=n("./src/gui/guiFx.ts"),c=n("./src/gui/guiFooter.ts"),l=n("./src/gui/guiStatsBar.ts");class u extends r.GuiBase{constructor(t,e,n,r){super(t,e),this._gameEngine=n,this._statsBar=new l.GuiStatsBar(this.retrieveElement("stats_bar"),e,n.expressionEngine,r.statsBar),this._messageWindow=new s.GuiMessageWindow(this.retrieveElement("message_window"),e,r.messageWindow),this._modalBox=new i.GuiModalBox(this.retrieveElement("modal_container"),e),this._itemList=new o.GuiItemList(this.retrieveElement("items_window"),e,this._gameEngine.inventory,this._gameEngine.itemRegistry,r.itemList),this._statusList=new o.GuiStatusList(this.retrieveElement("status_window"),e,this._gameEngine.statusTable,this._gameEngine.statusRegistry,r.statusList),this._footer=new c.GuiFooter(this.retrieveElement("footer"),e,this._modalBox,r.footer),this._fx=new a.GuiFX(this.retrieveElement("fx_container"),e),this._gameEngine.variableStore.onVariableChanged=(t,e)=>{this.handleVariableUpdate(t,e)},this._itemList.onItemClicked=t=>{this._modalBox.display(t.unlocalizedName,t.unlocalizedDescription,"ui.ok",t.icon)},this._statusList.onItemClicked=t=>{this._modalBox.display(t.unlocalizedName,t.unlocalizedDescription,"ui.ok",t.icon)}}playFx(t){if("confetti"!==t)throw new Error(`Unknown fx "${t}".`);this._fx.confetti()}retrieveElement(t){let e=document.getElementById(t);if(!e)throw new Error(`Unable to find #${t}.`);return e}handleVariableUpdate(t,e){this._statsBar.handleVariableUpdate(t,e)}displayMessage(t,e,n,i){return i&&this.playFx(i),this._messageWindow.displayMessage(t,e,n)}displayChoices(t,e,n){return this._messageWindow.displayChoices(t,e,n)}}},"./src/gui/guiMessageWindow.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{GuiMessageWindow:()=>o});var i=n("./src/gui/guiBase.ts"),r=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))};const s=new RegExp(`^[${["\\p{Script=Han}","\\p{Script=Bopomofo}","\\p{Script=Katakana}","\\p{Script=Hiragana}","\\p{Script=Hangul}"].join("")}]$`,"u");class o extends i.GuiBase{constructor(t,e,n){if(super(t,e),this._messageContainer=this.createAndAddChild("div","","message_container"),this._choicesContainer=this.createAndAddChild("div","","choices_container"),null==n||null==n.typewriterSpeed)this._typewriterSpeed=30;else{if("number"!=typeof n.typewriterSpeed||isNaN(n.typewriterSpeed))throw new Error("Typewrite speed must be a valid number.");this._typewriterSpeed=n.typewriterSpeed}this._typewriterSpeed>0?this._typewriterFrameTime=1e3/this._typewriterSpeed:this._typewriterFrameTime=0}displayMessage(t,e,n){return r(this,void 0,void 0,(function*(){return this._typewriterSpeed>0?yield this.typewriteMessage(t,n):this.updateMessage(t,n),new Promise((t=>{const n=document.createElement("a");n.className="btn",n.href="javascript: void(0)",n.innerHTML=this._textEngine.localizeAndRender(e),this._choicesContainer.appendChild(n),n.onclick=()=>{this._messageContainer.textContent="",n.onclick=null,n.remove(),t()}}))}))}displayChoices(t,e,n){return r(this,void 0,void 0,(function*(){return this._typewriterSpeed>0?yield this.typewriteMessage(t,n):this.updateMessage(t,n),new Promise((t=>{let n=[];for(let i=0;i<e.length;i++){let r=document.createElement("a"),[s,o]=e[i];r.className="btn",r.innerHTML=this._textEngine.localizeAndRender(s),r.href="javascript: void(0);",r.setAttribute("data-choice-number",o.toString()),r.onclick=()=>{for(r of(this._messageContainer.textContent="",n))r.remove();t(o)},n.push(r),this._choicesContainer.appendChild(r)}}))}))}updateMessage(t,e){let n=`<p>${this._textEngine.localizeAndRender(t)}</p>`;e&&(n+=`<p><img src="${e}" /></p>`),this._messageContainer.innerHTML=n}typewriteMessage(t,e){return new Promise((n=>{this.removeAllChildrenOf(this._messageContainer);let i=document.createElement("p");this._messageContainer.appendChild(i);let r=function(t){const e=[];let n=0,i=0;for(;n<t.length;){const r=t[n];if(" "===r){for(++n;n<t.length&&" "===t[n];);e.push(t.substring(i,n)),i=n}else s.test(r)?(++n,e.push(t.substring(i,n)),i=n):++n}return i<n&&e.push(t.substring(i,n)),e}(this._textEngine.localize(t)),o="",a=0,c=null,l=t=>{c||(c=t);const s=t-c,u=Math.min(s/this._typewriterFrameTime,r.length);for(;a<u;)o+=r[a],++a;if(i.innerHTML=this._textEngine.render(o),a===r.length){if(e){let t=document.createElement("p"),n=document.createElement("img");n.src=e,t.appendChild(n),this._messageContainer.appendChild(t)}n()}else requestAnimationFrame(l)};requestAnimationFrame(l)}))}}},"./src/gui/guiModalBox.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{GuiModalBox:()=>r});var i=n("./src/gui/guiBase.ts");class r extends i.GuiBase{constructor(t,e){super(t,e),this._pending=[],this._shown=!1,this._contentBox=this.createAndAddChild("div","","modal_content"),this._titleContainer=document.createElement("h3"),this._messageContainer=document.createElement("div"),this._messageContainer.className="modal_message",this._confirmBtn=document.createElement("a"),this._confirmBtn.className="btn_confirm btn",this._confirmBtn.href="javascript:void(0)",this._contentBox.appendChild(this._titleContainer),this._contentBox.appendChild(this._messageContainer),this._contentBox.appendChild(this._confirmBtn),this._confirmBtn.onclick=()=>{if(this._pending.length>0){const t=this._pending.shift();this._setContent(t.title,t.message,t.confirm,t.icon)}else this.setHidden(!0),this._clearContent()}}display(t,e,n,i){this._shown?this._pending.push({title:this._textEngine.localizeAndRender(t),message:this._textEngine.localizeAndRender(e),confirm:this._textEngine.localizeAndRender(n),icon:i}):(this._setContent(this._textEngine.localizeAndRender(t),this._textEngine.localizeAndRender(e),this._textEngine.localizeAndRender(n),i),this.setHidden(!1))}_setContent(t,e,n,i){this._titleContainer.textContent=t;const r=document.createElement("p");if(r.innerHTML=e,this._messageContainer.appendChild(r),i){const t=document.createElement("img");t.src=i,this._messageContainer.appendChild(t)}this._confirmBtn.textContent=n}_clearContent(){this._titleContainer.textContent="",this._messageContainer.innerHTML="",this._confirmBtn.textContent=""}}},"./src/gui/guiStatsBar.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{GuiStatsBar:()=>s});var i=n("./src/gui/guiBase.ts");class r{constructor(t,e,n){if(this._conditionalStyles=[],this._container=t,this._text=n.text,n.conditionalStyles)for(const t of n.conditionalStyles)this._conditionalStyles.push({conditionExpression:e.compile(t.condition),classNames:t.styleClasses?[...t.styleClasses]:[]})}update(t,e){this._container.innerHTML=t.localizeAndRender(this._text);let n=!1;for(const t of this._conditionalStyles)if(e.eval(t.conditionExpression)){this._container.className=t.classNames.join(" "),n=!0;break}n||(this._container.className="")}}class s extends i.GuiBase{constructor(t,e,n,i){if(super(t,e),this._itemsByTriggeringVariable={},this._expressionEvaluator=n,!i||!i.items)return;const s=this.createAndAddChild("div","stats_left"),o=this.createAndAddChild("div","stats_right");for(const t of i.items){e.getLocalizationDictionary().addRequiredKey(t.text);const i=document.createElement("p"),a=new r(i,n,t);if(t.side&&"left"!==t.side){if("right"!==t.side)throw new Error(`Unknown side: ${t.side}.`);o.appendChild(i)}else s.appendChild(i);if(t.updateTrigger)for(const e of t.updateTrigger.variables)e in this._itemsByTriggeringVariable?this._itemsByTriggeringVariable[e].push(a):this._itemsByTriggeringVariable[e]=[a]}}handleVariableUpdate(t,e){if(!e.clear&&e.varName in this._itemsByTriggeringVariable)for(const t of this._itemsByTriggeringVariable[e.varName])t.update(this._textEngine,this._expressionEvaluator)}}},"./src/gui/textEngine.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{SimpleGameTextEngine:()=>r});var i=n("./src/utils/expression.ts");class r{constructor(t,e,n){this._ldict=t,this._variableStore=e,this._random=n}render(t){return t=t.replace(/\{\{(@?[a-z0-9$_.]+)(:\d+)?\}\}/gi,((t,e,n)=>{if("@"===e[0]){let n=e.substring(1);return this._evalSpecialVariable(n)||t}if((0,i.isVariableName)(e)){let i=this._variableStore.getVar(e,!1);return null==i?(console.log("Undefined variable "+e),t):null==n?i.toString():i.toFixed(parseInt(n.slice(1)))}return t})),function(t){let e=[],n="",i=0,r=0;for(;i<t.length;){if(!(t[i]in s)){++i;continue}let o=t[i];if(i+1<t.length&&t[i+1]===o){i>r&&(n+=t.substring(r,i));let a=!1;e.length>0&&o===e[e.length-1]?(e.pop(),n+=s[o][1],a=!0):0!==e.length&&"`"===e[e.length-1]||(e.push(t[i]),n+=s[o][0],a=!0),i+=2,a&&(r=i)}else++i}i>r&&(n+=t.substring(r,i));for(;e.length>0;)n+=s[e.pop()][1];return n}(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))}localizeAndRender(t){return this.render(this.localize(t))}localize(t){return this._ldict.translate(t)}getLocalizationDictionary(){return this._ldict}_evalSpecialVariable(t){if((0,i.isVariableName)(t))switch(t){case"seed":return this._random.seed;case"seedUrl":return`${window.location.protocol+"//"+window.location.host+window.location.pathname}#init_seed=${encodeURIComponent(this._random.seed)}`;default:return}}}const s={"*":["<em>","</em>"],"#":["<strong>","</strong>"],_:['<span style="text-decoration: underline">',"</span>"],"`":["<code>","</code>"]}},"./src/i18n/localization.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{LocalizationDictionary:()=>o});var i=n("./src/utils/network.ts"),r=n("./node_modules/js-yaml/dist/js-yaml.mjs"),s=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))};class o{constructor(){this._dict=new Map,this._requiredTranslationKeys=new Set}addTranslation(t,e){this._dict.set(t,e)}addRequiredKey(t){this._requiredTranslationKeys.add(t)}translate(t){const e=this._dict.get(t);return null==e?t:e}dumpMissingTranslationKeys(){let t=[];for(const e of this._requiredTranslationKeys)this._dict.has(e)||t.push(e);return t.sort(),t}dumpRequiredTranslationKeys(){let t=[...this._requiredTranslationKeys];return t.sort(),t}dumpUnnecessaryTranslationKeys(){let t=[];for(const e of this._dict.keys())this._requiredTranslationKeys.has(e)||t.push(e);return t.sort(),t}loadFrom(t){return s(this,void 0,void 0,(function*(){let e=yield(0,i.downloadAndParse)(t,r.load);if(null==e)throw new Error(`Failed to load translation file from: ${t}`);let n=0;for(let t in e){const i=e[t];if("string"!=typeof i)throw new Error(`Translation of "${t}" should be a string.`);this.addTranslation(t,i),++n}console.log(`Successfully loaded ${n} translations.`)}))}}},"./src/utils/collection.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{SetBuilder:()=>i});class i{constructor(t=new Set,e=!1){this._set=t,this._built=e}add(...t){this.addAll(t)}addAll(t){if(this._built)throw new Error("Cannot add element(s) after the set is built!");for(let e of t)this._set.add(e)}get(){return this._built=!0,this._set}}},"./src/utils/expression.ts":(t,e,n)=>{"use strict";var i;n.r(e),n.d(e,{compileExpression:()=>o,isVariableName:()=>s}),function(t){t[t.Name=0]="Name",t[t.Number=1]="Number",t[t.Boolean=2]="Boolean",t[t.String=3]="String",t[t.Operator=4]="Operator",t[t.Delimiter=5]="Delimiter",t[t.Whitespace=6]="Whitespace"}(i||(i={}));const r=[{tokenType:i.Whitespace,regex:/^\s+/g},{tokenType:i.Boolean,regex:/^true|^false/},{tokenType:i.Name,regex:/^[a-z_$][a-z0-9_$]*(\.[a-z_$][a-z0-9_$]*)*/i},{tokenType:i.Number,regex:/^[+-]?Infinity|^NaN|^(\d+(\.\d+)?([Ee][+-]?\d+)?)/},{tokenType:i.String,regex:/^'(\\['\\]|[^'])*'/},{tokenType:i.Operator,regex:/^(\+|-|\*|\/|%|\(|\)|>=|>|<=|<|&&|&|\|\||\||!|:|\?|===|==|!==|!=)/},{tokenType:i.Delimiter,regex:/^,/}];function s(t){return/^[a-z_$][a-z0-9_$]*(\.[a-z_$][a-z0-9_$]*)*$/i.test(t)}function o(t,e){const n=function(t){let e=[];for(;t.length>0;){let n=!1;for(let s of r){let r=s.regex.exec(t);if(r){n=!0,s.tokenType!==i.Whitespace&&e.push({type:s.tokenType,text:r[0]}),t=t.slice(r[0].length);break}}if(!n)throw new Error(`Invalid syntax starting at: ${t}`)}return e}(t);let s='"use strict";\nreturn (',o=0;for(;o<n.length;){const t=n[o];switch(t.type){case i.Name:if(t.text.indexOf(".")>0||o>=n.length-2||n[o+1].type!==i.Operator||"("!==n[o+1].text)s+=`__functions.getVar('${t.text}')`;else{if(!e.existsFunction(t.text))throw new Error(`Unsupported function "${t.text}".`);s+="__functions."+t.text}break;case i.Number:case i.Boolean:case i.Operator:case i.String:case i.Delimiter:s+=t.text;break;default:throw new Error("Unexpected token type.")}++o}return s+=");",{source:t,fn:new Function("__functions",s)}}},"./src/utils/network.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{downloadAndParse:()=>r});var i=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))};function r(t,e){return i(this,void 0,void 0,(function*(){return new Promise(((n,i)=>{const r=new XMLHttpRequest;r.open("GET",t,!0),r.onreadystatechange=()=>{r.readyState==XMLHttpRequest.DONE&&(200==r.status?n(e(r.responseText)):i(new Error("Error status: "+r.statusText)))},r.send()}))}))}},"./src/utils/priorityQueue.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{PriorityQueue:()=>i});class i{constructor(t){this._data=[],this._comparator=t||((t,e)=>t<e)}get length(){return this._data.length}empty(){return 0===this._data.length}push(t){this._data.push(t),this._heapUp(this._data.length-1)}pop(){if(0===this._data.length)throw new Error("Cannot pop from an empty queue.");const t=this._data[0];return 1===this._data.length?(this._data.pop(),t):(this._swap(0,this._data.length-1),this._data.pop(),this._heapDown(0),t)}top(){if(0===this._data.length)throw new Error("Cannot access the top element of an empty queue.");return this._data[0]}clear(){this._data=[]}_swap(t,e){const n=this._data[t];this._data[t]=this._data[e],this._data[e]=n}_heapUp(t){if(0!==t)for(;t>0;){const e=t-1>>1;if(!this._comparator(this._data[e],this._data[t]))break;this._swap(e,t),t=e}}_heapDown(t){if(!(this._data.length<=1))for(;t<this._data.length;){const e=t+1<<1,n=e-1;if(n>=this._data.length)break;if(e>=this._data.length){if(!this._comparator(this._data[t],this._data[n]))break;this._swap(t,n),t=n}else{const i=this._comparator(this._data[n],this._data[e])?e:n;if(!this._comparator(this._data[t],this._data[i]))break;this._swap(t,i),t=i}}}}},"./src/utils/random.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{AleaRandomSource:()=>s,weightedSample:()=>r});var i=n("./node_modules/seedrandom/index.js");function r(t,e){if(0===t.length)throw new Error("Must have at least one weight value.");let n=new Array(t.length+1),i=0;for(let e=0;e<t.length;e++){if(n[e]=i,t[e]<0)throw new Error("Weights cannot be negative.");i+=t[e]}if(n[n.length-1]=i,0===i)throw new Error("Sum of weights must be positive.");let r=e()*i,s=0;for(;s<t.length&&!(r>=n[s]&&r<n[s+1]);s++);return s}class s{constructor(t){this._seed=t,this._random=i.alea(t,{state:!0})}get seed(){return this._seed}next(){return this._random.double()}reset(t){null==t?t=this._seed:this._seed=t,this._random=i.alea(t,{state:!0})}}},"./src/utils/simpleRegistry.ts":(t,e,n)=>{"use strict";n.r(e),n.d(e,{SimpleRegistry:()=>i});class i{constructor(){this._items=new Map}add(t){const e=this._items.get(t.id);if(null!=e&&e!==t)throw new Error("Cannot register two different items under the same id.");this._items.set(t.id,t)}has(t){return"string"==typeof t?this._items.has(t):this._items.get(t.id)===t}get(t){const e=this._items.get(t);if(null==e)throw new Error(`"${t}" does not exist in "${this.name}".`);return e}forEach(t){for(let e of this._items.values())t(e)}}},"./src/variableStore.ts":(t,e,n)=>{"use strict";function i(t){return"number"==typeof t||"string"==typeof t&&("NaN"===t||"Infinity"===t||"-Infinity"===t)}function r(t){return isNaN(t)?"NaN":isFinite(t)?t:t>0?"Infinity":"-Infinity"}function s(t){if("string"==typeof t){if("NaN"===t)return NaN;if("Infinity"===t)return 1/0;if("-Infinity"===t)return-1/0;throw new Error("Unable to decode "+t)}return t}n.r(e),n.d(e,{VariableChangedEvent:()=>o,VariableStore:()=>a});class o{constructor(t,e,n,i){this.clear=t,this.varName=e,this.oldValue=n,this.newValue=i}}class a{constructor(){this._variables={},this._varLimits={}}setVar(t,e,n=!1){if(n&&!(t in this._variables))throw new Error(`Variable "${t}" does not exist.`);this._varLimits[t]&&(e>this._varLimits[t][1]&&(e=this._varLimits[t][1]),e<this._varLimits[t][0]&&(e=this._varLimits[t][0]));let i=this._variables[t];if(this._variables[t]=e,i!==e){const n=new o(!1,t,i,e);setTimeout((()=>this.dispatchChangeEvent(n)),0)}}setVarLimits(t,e,n){if(isNaN(e))throw new Error("Lower bound cannot be NaN");if(isNaN(n))throw new Error("Upper bound cannot be NaN");if(e>n)throw new Error("Lower bound cannot be greater than upper bound.");if(this._varLimits[t]=[e,n],!(t in this._variables))return;const i=this._variables[t];if(i<e){this._variables[t]=e;const n=new o(!1,t,i,e);setTimeout((()=>this.dispatchChangeEvent(n)),0)}else if(i>n){this._variables[t]=n;const e=new o(!1,t,i,n);setTimeout((()=>this.dispatchChangeEvent(e)),0)}}getVarLimits(t){let e=this._varLimits[t];return e?[e[0],e[1]]:[-1/0,1/0]}getVar(t,e=!0){let n=this._variables[t];if(null==n&&e)throw new Error(`Variable "${t}" does not exist.`);return n}reset(){this.dispatchChangeEvent(new o(!0,"",0,0)),this._variables={}}dumpToConsole(){let t=[];t.push("[Variables (Limits)]");for(let e in this._variables){const n=this._varLimits[e],i=n?` ([${n[0]}, ${n[1]}])`:"";t.push(`${e}: ${this._variables[e]}${i}`)}console.log(t.join("\n"))}decodeFromJson(t){if(null===t||"object"!=typeof t||Array.isArray(t))throw new Error("Non-null JSON object expected.");this.reset();for(const e in t){const n=t[e];if(i(n))this.setVar(e,s(n));else if(Array.isArray(n)){if(3!==n.length)throw new Error("Expect 3 elements: value, lower bound, upper bound.");const[t,r,o]=n;if(!i(t))throw new Error("Invalid variable value.");if(!i(r))throw new Error("Invalid variable lower bound.");if(!i(o))throw new Error("Invalid variable upper bound.");this.setVar(e,s(t)),this.setVarLimits(e,s(r),s(o))}}}encodeAsJson(){let t={};for(const e in this._variables){const n=this._variables[e];if(e in this._varLimits){const[i,s]=this._varLimits[e];t[e]=[r(n),r(i),r(s)]}else t[e]=r(n)}return t}dispatchChangeEvent(t){this.onVariableChanged&&this.onVariableChanged(this,t)}}},"?d4c0":()=>{},"./node_modules/decode-uri-component/index.js":(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>c});const i="%[a-f0-9]{2}",r=new RegExp("("+i+")|([^%]+?)","gi"),s=new RegExp("("+i+")+","gi");function o(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(1===t.length)return t;e=e||1;const n=t.slice(0,e),i=t.slice(e);return Array.prototype.concat.call([],o(n),o(i))}function a(t){try{return decodeURIComponent(t)}catch{let e=t.match(r)||[];for(let n=1;n<e.length;n++)e=(t=o(e,n).join("")).match(r)||[];return t}}function c(t){if("string"!=typeof t)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return decodeURIComponent(t)}catch{return function(t){const e={"%FE%FF":"","%FF%FE":""};let n=s.exec(t);for(;n;){try{e[n[0]]=decodeURIComponent(n[0])}catch{const t=a(n[0]);t!==n[0]&&(e[n[0]]=t)}n=s.exec(t)}e["%C2"]="";const i=Object.keys(e);for(const n of i)t=t.replace(new RegExp(n,"g"),e[n]);return t}(t)}}},"./node_modules/filter-obj/index.js":(t,e,n)=>{"use strict";function i(t,e){const n={};if(Array.isArray(e))for(const i of e){const e=Object.getOwnPropertyDescriptor(t,i);e?.enumerable&&Object.defineProperty(n,i,e)}else for(const i of Reflect.ownKeys(t)){const r=Object.getOwnPropertyDescriptor(t,i);if(r.enumerable){e(i,t[i],t)&&Object.defineProperty(n,i,r)}}return n}function r(t,e){if(Array.isArray(e)){const n=new Set(e);return i(t,(t=>!n.has(t)))}return i(t,((t,n,i)=>!e(t,n,i)))}n.r(e),n.d(e,{excludeKeys:()=>r,includeKeys:()=>i})},"./node_modules/js-yaml/dist/js-yaml.mjs":(t,e,n)=>{"use strict";function i(t){return null==t}n.r(e),n.d(e,{CORE_SCHEMA:()=>Ve,DEFAULT_SCHEMA:()=>Ue,FAILSAFE_SCHEMA:()=>Ke,JSON_SCHEMA:()=>Ge,Schema:()=>ze,Type:()=>Be,YAMLException:()=>Je,default:()=>Qe,dump:()=>Pe,load:()=>$e,loadAll:()=>qe,safeDump:()=>Xe,safeLoad:()=>He,safeLoadAll:()=>Ye,types:()=>We});var r={isNothing:i,isObject:function(t){return"object"==typeof t&&null!==t},toArray:function(t){return Array.isArray(t)?t:i(t)?[]:[t]},repeat:function(t,e){var n,i="";for(n=0;n<e;n+=1)i+=t;return i},isNegativeZero:function(t){return 0===t&&Number.NEGATIVE_INFINITY===1/t},extend:function(t,e){var n,i,r,s;if(e)for(n=0,i=(s=Object.keys(e)).length;n<i;n+=1)t[r=s[n]]=e[r];return t}};function s(t,e){var n="",i=t.reason||"(unknown reason)";return t.mark?(t.mark.name&&(n+='in "'+t.mark.name+'" '),n+="("+(t.mark.line+1)+":"+(t.mark.column+1)+")",!e&&t.mark.snippet&&(n+="\n\n"+t.mark.snippet),i+" "+n):i}function o(t,e){Error.call(this),this.name="YAMLException",this.reason=t,this.mark=e,this.message=s(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||""}o.prototype=Object.create(Error.prototype),o.prototype.constructor=o,o.prototype.toString=function(t){return this.name+": "+s(this,t)};var a=o;function c(t,e,n,i,r){var s="",o="",a=Math.floor(r/2)-1;return i-e>a&&(e=i-a+(s=" ... ").length),n-i>a&&(n=i+a-(o=" ...").length),{str:s+t.slice(e,n).replace(/\t/g,"")+o,pos:i-e+s.length}}function l(t,e){return r.repeat(" ",e-t.length)+t}var u=function(t,e){if(e=Object.create(e||null),!t.buffer)return null;e.maxLength||(e.maxLength=79),"number"!=typeof e.indent&&(e.indent=1),"number"!=typeof e.linesBefore&&(e.linesBefore=3),"number"!=typeof e.linesAfter&&(e.linesAfter=2);for(var n,i=/\r?\n|\r|\0/g,s=[0],o=[],a=-1;n=i.exec(t.buffer);)o.push(n.index),s.push(n.index+n[0].length),t.position<=n.index&&a<0&&(a=s.length-2);a<0&&(a=s.length-1);var u,d,h="",f=Math.min(t.line+e.linesAfter,o.length).toString().length,p=e.maxLength-(e.indent+f+3);for(u=1;u<=e.linesBefore&&!(a-u<0);u++)d=c(t.buffer,s[a-u],o[a-u],t.position-(s[a]-s[a-u]),p),h=r.repeat(" ",e.indent)+l((t.line-u+1).toString(),f)+" | "+d.str+"\n"+h;for(d=c(t.buffer,s[a],o[a],t.position,p),h+=r.repeat(" ",e.indent)+l((t.line+1).toString(),f)+" | "+d.str+"\n",h+=r.repeat("-",e.indent+f+3+d.pos)+"^\n",u=1;u<=e.linesAfter&&!(a+u>=o.length);u++)d=c(t.buffer,s[a+u],o[a+u],t.position-(s[a]-s[a+u]),p),h+=r.repeat(" ",e.indent)+l((t.line+u+1).toString(),f)+" | "+d.str+"\n";return h.replace(/\n$/,"")},d=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],h=["scalar","sequence","mapping"];var f=function(t,e){if(e=e||{},Object.keys(e).forEach((function(e){if(-1===d.indexOf(e))throw new a('Unknown option "'+e+'" is met in definition of "'+t+'" YAML type.')})),this.options=e,this.tag=t,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=function(t){var e={};return null!==t&&Object.keys(t).forEach((function(n){t[n].forEach((function(t){e[String(t)]=n}))})),e}(e.styleAliases||null),-1===h.indexOf(this.kind))throw new a('Unknown kind "'+this.kind+'" is specified for "'+t+'" YAML type.')};function p(t,e){var n=[];return t[e].forEach((function(t){var e=n.length;n.forEach((function(n,i){n.tag===t.tag&&n.kind===t.kind&&n.multi===t.multi&&(e=i)})),n[e]=t})),n}function g(t){return this.extend(t)}g.prototype.extend=function(t){var e=[],n=[];if(t instanceof f)n.push(t);else if(Array.isArray(t))n=n.concat(t);else{if(!t||!Array.isArray(t.implicit)&&!Array.isArray(t.explicit))throw new a("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.implicit&&(e=e.concat(t.implicit)),t.explicit&&(n=n.concat(t.explicit))}e.forEach((function(t){if(!(t instanceof f))throw new a("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(t.loadKind&&"scalar"!==t.loadKind)throw new a("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(t.multi)throw new a("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")})),n.forEach((function(t){if(!(t instanceof f))throw new a("Specified list of YAML types (or a single Type object) contains a non-Type object.")}));var i=Object.create(g.prototype);return i.implicit=(this.implicit||[]).concat(e),i.explicit=(this.explicit||[]).concat(n),i.compiledImplicit=p(i,"implicit"),i.compiledExplicit=p(i,"explicit"),i.compiledTypeMap=function(){var t,e,n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}};function i(t){t.multi?(n.multi[t.kind].push(t),n.multi.fallback.push(t)):n[t.kind][t.tag]=n.fallback[t.tag]=t}for(t=0,e=arguments.length;t<e;t+=1)arguments[t].forEach(i);return n}(i.compiledImplicit,i.compiledExplicit),i};var m=g,y=new f("tag:yaml.org,2002:str",{kind:"scalar",construct:function(t){return null!==t?t:""}}),_=new f("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(t){return null!==t?t:[]}}),v=new f("tag:yaml.org,2002:map",{kind:"mapping",construct:function(t){return null!==t?t:{}}}),b=new m({explicit:[y,_,v]});var w=new f("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(t){if(null===t)return!0;var e=t.length;return 1===e&&"~"===t||4===e&&("null"===t||"Null"===t||"NULL"===t)},construct:function(){return null},predicate:function(t){return null===t},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});var x=new f("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e=t.length;return 4===e&&("true"===t||"True"===t||"TRUE"===t)||5===e&&("false"===t||"False"===t||"FALSE"===t)},construct:function(t){return"true"===t||"True"===t||"TRUE"===t},predicate:function(t){return"[object Boolean]"===Object.prototype.toString.call(t)},represent:{lowercase:function(t){return t?"true":"false"},uppercase:function(t){return t?"TRUE":"FALSE"},camelcase:function(t){return t?"True":"False"}},defaultStyle:"lowercase"});function E(t){return 48<=t&&t<=55}function A(t){return 48<=t&&t<=57}var S=new f("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e,n,i=t.length,r=0,s=!1;if(!i)return!1;if("-"!==(e=t[r])&&"+"!==e||(e=t[++r]),"0"===e){if(r+1===i)return!0;if("b"===(e=t[++r])){for(r++;r<i;r++)if("_"!==(e=t[r])){if("0"!==e&&"1"!==e)return!1;s=!0}return s&&"_"!==e}if("x"===e){for(r++;r<i;r++)if("_"!==(e=t[r])){if(!(48<=(n=t.charCodeAt(r))&&n<=57||65<=n&&n<=70||97<=n&&n<=102))return!1;s=!0}return s&&"_"!==e}if("o"===e){for(r++;r<i;r++)if("_"!==(e=t[r])){if(!E(t.charCodeAt(r)))return!1;s=!0}return s&&"_"!==e}}if("_"===e)return!1;for(;r<i;r++)if("_"!==(e=t[r])){if(!A(t.charCodeAt(r)))return!1;s=!0}return!(!s||"_"===e)},construct:function(t){var e,n=t,i=1;if(-1!==n.indexOf("_")&&(n=n.replace(/_/g,"")),"-"!==(e=n[0])&&"+"!==e||("-"===e&&(i=-1),e=(n=n.slice(1))[0]),"0"===n)return 0;if("0"===e){if("b"===n[1])return i*parseInt(n.slice(2),2);if("x"===n[1])return i*parseInt(n.slice(2),16);if("o"===n[1])return i*parseInt(n.slice(2),8)}return i*parseInt(n,10)},predicate:function(t){return"[object Number]"===Object.prototype.toString.call(t)&&t%1==0&&!r.isNegativeZero(t)},represent:{binary:function(t){return t>=0?"0b"+t.toString(2):"-0b"+t.toString(2).slice(1)},octal:function(t){return t>=0?"0o"+t.toString(8):"-0o"+t.toString(8).slice(1)},decimal:function(t){return t.toString(10)},hexadecimal:function(t){return t>=0?"0x"+t.toString(16).toUpperCase():"-0x"+t.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),C=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");var T=/^[-+]?[0-9]+e/;var k=new f("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(t){return null!==t&&!(!C.test(t)||"_"===t[t.length-1])},construct:function(t){var e,n;return n="-"===(e=t.replace(/_/g,"").toLowerCase())[0]?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),".inf"===e?1===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===e?NaN:n*parseFloat(e,10)},predicate:function(t){return"[object Number]"===Object.prototype.toString.call(t)&&(t%1!=0||r.isNegativeZero(t))},represent:function(t,e){var n;if(isNaN(t))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===t)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===t)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(r.isNegativeZero(t))return"-0.0";return n=t.toString(10),T.test(n)?n.replace("e",".e"):n},defaultStyle:"lowercase"}),O=b.extend({implicit:[w,x,S,k]}),I=O,j=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),N=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");var F=new f("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(t){return null!==t&&(null!==j.exec(t)||null!==N.exec(t))},construct:function(t){var e,n,i,r,s,o,a,c,l=0,u=null;if(null===(e=j.exec(t))&&(e=N.exec(t)),null===e)throw new Error("Date resolve error");if(n=+e[1],i=+e[2]-1,r=+e[3],!e[4])return new Date(Date.UTC(n,i,r));if(s=+e[4],o=+e[5],a=+e[6],e[7]){for(l=e[7].slice(0,3);l.length<3;)l+="0";l=+l}return e[9]&&(u=6e4*(60*+e[10]+ +(e[11]||0)),"-"===e[9]&&(u=-u)),c=new Date(Date.UTC(n,i,r,s,o,a,l)),u&&c.setTime(c.getTime()-u),c},instanceOf:Date,represent:function(t){return t.toISOString()}});var M=new f("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(t){return"<<"===t||null===t}}),R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";var L=new f("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e,n,i=0,r=t.length,s=R;for(n=0;n<r;n++)if(!((e=s.indexOf(t.charAt(n)))>64)){if(e<0)return!1;i+=6}return i%8==0},construct:function(t){var e,n,i=t.replace(/[\r\n=]/g,""),r=i.length,s=R,o=0,a=[];for(e=0;e<r;e++)e%4==0&&e&&(a.push(o>>16&255),a.push(o>>8&255),a.push(255&o)),o=o<<6|s.indexOf(i.charAt(e));return 0===(n=r%4*6)?(a.push(o>>16&255),a.push(o>>8&255),a.push(255&o)):18===n?(a.push(o>>10&255),a.push(o>>2&255)):12===n&&a.push(o>>4&255),new Uint8Array(a)},predicate:function(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)},represent:function(t){var e,n,i="",r=0,s=t.length,o=R;for(e=0;e<s;e++)e%3==0&&e&&(i+=o[r>>18&63],i+=o[r>>12&63],i+=o[r>>6&63],i+=o[63&r]),r=(r<<8)+t[e];return 0===(n=s%3)?(i+=o[r>>18&63],i+=o[r>>12&63],i+=o[r>>6&63],i+=o[63&r]):2===n?(i+=o[r>>10&63],i+=o[r>>4&63],i+=o[r<<2&63],i+=o[64]):1===n&&(i+=o[r>>2&63],i+=o[r<<4&63],i+=o[64],i+=o[64]),i}}),D=Object.prototype.hasOwnProperty,B=Object.prototype.toString;var z=new f("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(t){if(null===t)return!0;var e,n,i,r,s,o=[],a=t;for(e=0,n=a.length;e<n;e+=1){if(i=a[e],s=!1,"[object Object]"!==B.call(i))return!1;for(r in i)if(D.call(i,r)){if(s)return!1;s=!0}if(!s)return!1;if(-1!==o.indexOf(r))return!1;o.push(r)}return!0},construct:function(t){return null!==t?t:[]}}),K=Object.prototype.toString;var G=new f("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(t){if(null===t)return!0;var e,n,i,r,s,o=t;for(s=new Array(o.length),e=0,n=o.length;e<n;e+=1){if(i=o[e],"[object Object]"!==K.call(i))return!1;if(1!==(r=Object.keys(i)).length)return!1;s[e]=[r[0],i[r[0]]]}return!0},construct:function(t){if(null===t)return[];var e,n,i,r,s,o=t;for(s=new Array(o.length),e=0,n=o.length;e<n;e+=1)i=o[e],r=Object.keys(i),s[e]=[r[0],i[r[0]]];return s}}),V=Object.prototype.hasOwnProperty;var U=new f("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(t){if(null===t)return!0;var e,n=t;for(e in n)if(V.call(n,e)&&null!==n[e])return!1;return!0},construct:function(t){return null!==t?t:{}}}),$=I.extend({implicit:[F,M],explicit:[L,z,G,U]}),q=Object.prototype.hasOwnProperty,P=1,J=2,W=3,H=4,Y=1,X=2,Q=3,Z=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,tt=/[\x85\u2028\u2029]/,et=/[,\[\]\{\}]/,nt=/^(?:!|!!|![a-z\-]+!)$/i,it=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function rt(t){return Object.prototype.toString.call(t)}function st(t){return 10===t||13===t}function ot(t){return 9===t||32===t}function at(t){return 9===t||32===t||10===t||13===t}function ct(t){return 44===t||91===t||93===t||123===t||125===t}function lt(t){var e;return 48<=t&&t<=57?t-48:97<=(e=32|t)&&e<=102?e-97+10:-1}function ut(t){return 48===t?"\0":97===t?"":98===t?"\b":116===t||9===t?"\t":110===t?"\n":118===t?"\v":102===t?"\f":114===t?"\r":101===t?"":32===t?" ":34===t?'"':47===t?"/":92===t?"\\":78===t?"":95===t?"":76===t?"\u2028":80===t?"\u2029":""}function dt(t){return t<=65535?String.fromCharCode(t):String.fromCharCode(55296+(t-65536>>10),56320+(t-65536&1023))}for(var ht=new Array(256),ft=new Array(256),pt=0;pt<256;pt++)ht[pt]=ut(pt)?1:0,ft[pt]=ut(pt);function gt(t,e){this.input=t,this.filename=e.filename||null,this.schema=e.schema||$,this.onWarning=e.onWarning||null,this.legacy=e.legacy||!1,this.json=e.json||!1,this.listener=e.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=t.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function mt(t,e){var n={name:t.filename,buffer:t.input.slice(0,-1),position:t.position,line:t.line,column:t.position-t.lineStart};return n.snippet=u(n),new a(e,n)}function yt(t,e){throw mt(t,e)}function _t(t,e){t.onWarning&&t.onWarning.call(null,mt(t,e))}var vt={YAML:function(t,e,n){var i,r,s;null!==t.version&&yt(t,"duplication of %YAML directive"),1!==n.length&&yt(t,"YAML directive accepts exactly one argument"),null===(i=/^([0-9]+)\.([0-9]+)$/.exec(n[0]))&&yt(t,"ill-formed argument of the YAML directive"),r=parseInt(i[1],10),s=parseInt(i[2],10),1!==r&&yt(t,"unacceptable YAML version of the document"),t.version=n[0],t.checkLineBreaks=s<2,1!==s&&2!==s&&_t(t,"unsupported YAML version of the document")},TAG:function(t,e,n){var i,r;2!==n.length&&yt(t,"TAG directive accepts exactly two arguments"),i=n[0],r=n[1],nt.test(i)||yt(t,"ill-formed tag handle (first argument) of the TAG directive"),q.call(t.tagMap,i)&&yt(t,'there is a previously declared suffix for "'+i+'" tag handle'),it.test(r)||yt(t,"ill-formed tag prefix (second argument) of the TAG directive");try{r=decodeURIComponent(r)}catch(e){yt(t,"tag prefix is malformed: "+r)}t.tagMap[i]=r}};function bt(t,e,n,i){var r,s,o,a;if(e<n){if(a=t.input.slice(e,n),i)for(r=0,s=a.length;r<s;r+=1)9===(o=a.charCodeAt(r))||32<=o&&o<=1114111||yt(t,"expected valid JSON character");else Z.test(a)&&yt(t,"the stream contains non-printable characters");t.result+=a}}function wt(t,e,n,i){var s,o,a,c;for(r.isObject(n)||yt(t,"cannot merge mappings; the provided source object is unacceptable"),a=0,c=(s=Object.keys(n)).length;a<c;a+=1)o=s[a],q.call(e,o)||(e[o]=n[o],i[o]=!0)}function xt(t,e,n,i,r,s,o,a,c){var l,u;if(Array.isArray(r))for(l=0,u=(r=Array.prototype.slice.call(r)).length;l<u;l+=1)Array.isArray(r[l])&&yt(t,"nested arrays are not supported inside keys"),"object"==typeof r&&"[object Object]"===rt(r[l])&&(r[l]="[object Object]");if("object"==typeof r&&"[object Object]"===rt(r)&&(r="[object Object]"),r=String(r),null===e&&(e={}),"tag:yaml.org,2002:merge"===i)if(Array.isArray(s))for(l=0,u=s.length;l<u;l+=1)wt(t,e,s[l],n);else wt(t,e,s,n);else t.json||q.call(n,r)||!q.call(e,r)||(t.line=o||t.line,t.lineStart=a||t.lineStart,t.position=c||t.position,yt(t,"duplicated mapping key")),"__proto__"===r?Object.defineProperty(e,r,{configurable:!0,enumerable:!0,writable:!0,value:s}):e[r]=s,delete n[r];return e}function Et(t){var e;10===(e=t.input.charCodeAt(t.position))?t.position++:13===e?(t.position++,10===t.input.charCodeAt(t.position)&&t.position++):yt(t,"a line break is expected"),t.line+=1,t.lineStart=t.position,t.firstTabInLine=-1}function At(t,e,n){for(var i=0,r=t.input.charCodeAt(t.position);0!==r;){for(;ot(r);)9===r&&-1===t.firstTabInLine&&(t.firstTabInLine=t.position),r=t.input.charCodeAt(++t.position);if(e&&35===r)do{r=t.input.charCodeAt(++t.position)}while(10!==r&&13!==r&&0!==r);if(!st(r))break;for(Et(t),r=t.input.charCodeAt(t.position),i++,t.lineIndent=0;32===r;)t.lineIndent++,r=t.input.charCodeAt(++t.position)}return-1!==n&&0!==i&&t.lineIndent<n&&_t(t,"deficient indentation"),i}function St(t){var e,n=t.position;return!(45!==(e=t.input.charCodeAt(n))&&46!==e||e!==t.input.charCodeAt(n+1)||e!==t.input.charCodeAt(n+2)||(n+=3,0!==(e=t.input.charCodeAt(n))&&!at(e)))}function Ct(t,e){1===e?t.result+=" ":e>1&&(t.result+=r.repeat("\n",e-1))}function Tt(t,e){var n,i,r=t.tag,s=t.anchor,o=[],a=!1;if(-1!==t.firstTabInLine)return!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=o),i=t.input.charCodeAt(t.position);0!==i&&(-1!==t.firstTabInLine&&(t.position=t.firstTabInLine,yt(t,"tab characters must not be used in indentation")),45===i)&&at(t.input.charCodeAt(t.position+1));)if(a=!0,t.position++,At(t,!0,-1)&&t.lineIndent<=e)o.push(null),i=t.input.charCodeAt(t.position);else if(n=t.line,It(t,e,W,!1,!0),o.push(t.result),At(t,!0,-1),i=t.input.charCodeAt(t.position),(t.line===n||t.lineIndent>e)&&0!==i)yt(t,"bad indentation of a sequence entry");else if(t.lineIndent<e)break;return!!a&&(t.tag=r,t.anchor=s,t.kind="sequence",t.result=o,!0)}function kt(t){var e,n,i,r,s=!1,o=!1;if(33!==(r=t.input.charCodeAt(t.position)))return!1;if(null!==t.tag&&yt(t,"duplication of a tag property"),60===(r=t.input.charCodeAt(++t.position))?(s=!0,r=t.input.charCodeAt(++t.position)):33===r?(o=!0,n="!!",r=t.input.charCodeAt(++t.position)):n="!",e=t.position,s){do{r=t.input.charCodeAt(++t.position)}while(0!==r&&62!==r);t.position<t.length?(i=t.input.slice(e,t.position),r=t.input.charCodeAt(++t.position)):yt(t,"unexpected end of the stream within a verbatim tag")}else{for(;0!==r&&!at(r);)33===r&&(o?yt(t,"tag suffix cannot contain exclamation marks"):(n=t.input.slice(e-1,t.position+1),nt.test(n)||yt(t,"named tag handle cannot contain such characters"),o=!0,e=t.position+1)),r=t.input.charCodeAt(++t.position);i=t.input.slice(e,t.position),et.test(i)&&yt(t,"tag suffix cannot contain flow indicator characters")}i&&!it.test(i)&&yt(t,"tag name cannot contain such characters: "+i);try{i=decodeURIComponent(i)}catch(e){yt(t,"tag name is malformed: "+i)}return s?t.tag=i:q.call(t.tagMap,n)?t.tag=t.tagMap[n]+i:"!"===n?t.tag="!"+i:"!!"===n?t.tag="tag:yaml.org,2002:"+i:yt(t,'undeclared tag handle "'+n+'"'),!0}function Ot(t){var e,n;if(38!==(n=t.input.charCodeAt(t.position)))return!1;for(null!==t.anchor&&yt(t,"duplication of an anchor property"),n=t.input.charCodeAt(++t.position),e=t.position;0!==n&&!at(n)&&!ct(n);)n=t.input.charCodeAt(++t.position);return t.position===e&&yt(t,"name of an anchor node must contain at least one character"),t.anchor=t.input.slice(e,t.position),!0}function It(t,e,n,i,s){var o,a,c,l,u,d,h,f,p,g=1,m=!1,y=!1;if(null!==t.listener&&t.listener("open",t),t.tag=null,t.anchor=null,t.kind=null,t.result=null,o=a=c=H===n||W===n,i&&At(t,!0,-1)&&(m=!0,t.lineIndent>e?g=1:t.lineIndent===e?g=0:t.lineIndent<e&&(g=-1)),1===g)for(;kt(t)||Ot(t);)At(t,!0,-1)?(m=!0,c=o,t.lineIndent>e?g=1:t.lineIndent===e?g=0:t.lineIndent<e&&(g=-1)):c=!1;if(c&&(c=m||s),1!==g&&H!==n||(f=P===n||J===n?e:e+1,p=t.position-t.lineStart,1===g?c&&(Tt(t,p)||function(t,e,n){var i,r,s,o,a,c,l,u=t.tag,d=t.anchor,h={},f=Object.create(null),p=null,g=null,m=null,y=!1,_=!1;if(-1!==t.firstTabInLine)return!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=h),l=t.input.charCodeAt(t.position);0!==l;){if(y||-1===t.firstTabInLine||(t.position=t.firstTabInLine,yt(t,"tab characters must not be used in indentation")),i=t.input.charCodeAt(t.position+1),s=t.line,63!==l&&58!==l||!at(i)){if(o=t.line,a=t.lineStart,c=t.position,!It(t,n,J,!1,!0))break;if(t.line===s){for(l=t.input.charCodeAt(t.position);ot(l);)l=t.input.charCodeAt(++t.position);if(58===l)at(l=t.input.charCodeAt(++t.position))||yt(t,"a whitespace character is expected after the key-value separator within a block mapping"),y&&(xt(t,h,f,p,g,null,o,a,c),p=g=m=null),_=!0,y=!1,r=!1,p=t.tag,g=t.result;else{if(!_)return t.tag=u,t.anchor=d,!0;yt(t,"can not read an implicit mapping pair; a colon is missed")}}else{if(!_)return t.tag=u,t.anchor=d,!0;yt(t,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===l?(y&&(xt(t,h,f,p,g,null,o,a,c),p=g=m=null),_=!0,y=!0,r=!0):y?(y=!1,r=!0):yt(t,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),t.position+=1,l=i;if((t.line===s||t.lineIndent>e)&&(y&&(o=t.line,a=t.lineStart,c=t.position),It(t,e,H,!0,r)&&(y?g=t.result:m=t.result),y||(xt(t,h,f,p,g,m,o,a,c),p=g=m=null),At(t,!0,-1),l=t.input.charCodeAt(t.position)),(t.line===s||t.lineIndent>e)&&0!==l)yt(t,"bad indentation of a mapping entry");else if(t.lineIndent<e)break}return y&&xt(t,h,f,p,g,null,o,a,c),_&&(t.tag=u,t.anchor=d,t.kind="mapping",t.result=h),_}(t,p,f))||function(t,e){var n,i,r,s,o,a,c,l,u,d,h,f,p=!0,g=t.tag,m=t.anchor,y=Object.create(null);if(91===(f=t.input.charCodeAt(t.position)))o=93,l=!1,s=[];else{if(123!==f)return!1;o=125,l=!0,s={}}for(null!==t.anchor&&(t.anchorMap[t.anchor]=s),f=t.input.charCodeAt(++t.position);0!==f;){if(At(t,!0,e),(f=t.input.charCodeAt(t.position))===o)return t.position++,t.tag=g,t.anchor=m,t.kind=l?"mapping":"sequence",t.result=s,!0;p?44===f&&yt(t,"expected the node content, but found ','"):yt(t,"missed comma between flow collection entries"),h=null,a=c=!1,63===f&&at(t.input.charCodeAt(t.position+1))&&(a=c=!0,t.position++,At(t,!0,e)),n=t.line,i=t.lineStart,r=t.position,It(t,e,P,!1,!0),d=t.tag,u=t.result,At(t,!0,e),f=t.input.charCodeAt(t.position),!c&&t.line!==n||58!==f||(a=!0,f=t.input.charCodeAt(++t.position),At(t,!0,e),It(t,e,P,!1,!0),h=t.result),l?xt(t,s,y,d,u,h,n,i,r):a?s.push(xt(t,null,y,d,u,h,n,i,r)):s.push(u),At(t,!0,e),44===(f=t.input.charCodeAt(t.position))?(p=!0,f=t.input.charCodeAt(++t.position)):p=!1}yt(t,"unexpected end of the stream within a flow collection")}(t,f)?y=!0:(a&&function(t,e){var n,i,s,o,a,c=Y,l=!1,u=!1,d=e,h=0,f=!1;if(124===(o=t.input.charCodeAt(t.position)))i=!1;else{if(62!==o)return!1;i=!0}for(t.kind="scalar",t.result="";0!==o;)if(43===(o=t.input.charCodeAt(++t.position))||45===o)Y===c?c=43===o?Q:X:yt(t,"repeat of a chomping mode identifier");else{if(!((s=48<=(a=o)&&a<=57?a-48:-1)>=0))break;0===s?yt(t,"bad explicit indentation width of a block scalar; it cannot be less than one"):u?yt(t,"repeat of an indentation width identifier"):(d=e+s-1,u=!0)}if(ot(o)){do{o=t.input.charCodeAt(++t.position)}while(ot(o));if(35===o)do{o=t.input.charCodeAt(++t.position)}while(!st(o)&&0!==o)}for(;0!==o;){for(Et(t),t.lineIndent=0,o=t.input.charCodeAt(t.position);(!u||t.lineIndent<d)&&32===o;)t.lineIndent++,o=t.input.charCodeAt(++t.position);if(!u&&t.lineIndent>d&&(d=t.lineIndent),st(o))h++;else{if(t.lineIndent<d){c===Q?t.result+=r.repeat("\n",l?1+h:h):c===Y&&l&&(t.result+="\n");break}for(i?ot(o)?(f=!0,t.result+=r.repeat("\n",l?1+h:h)):f?(f=!1,t.result+=r.repeat("\n",h+1)):0===h?l&&(t.result+=" "):t.result+=r.repeat("\n",h):t.result+=r.repeat("\n",l?1+h:h),l=!0,u=!0,h=0,n=t.position;!st(o)&&0!==o;)o=t.input.charCodeAt(++t.position);bt(t,n,t.position,!1)}}return!0}(t,f)||function(t,e){var n,i,r;if(39!==(n=t.input.charCodeAt(t.position)))return!1;for(t.kind="scalar",t.result="",t.position++,i=r=t.position;0!==(n=t.input.charCodeAt(t.position));)if(39===n){if(bt(t,i,t.position,!0),39!==(n=t.input.charCodeAt(++t.position)))return!0;i=t.position,t.position++,r=t.position}else st(n)?(bt(t,i,r,!0),Ct(t,At(t,!1,e)),i=r=t.position):t.position===t.lineStart&&St(t)?yt(t,"unexpected end of the document within a single quoted scalar"):(t.position++,r=t.position);yt(t,"unexpected end of the stream within a single quoted scalar")}(t,f)||function(t,e){var n,i,r,s,o,a,c;if(34!==(a=t.input.charCodeAt(t.position)))return!1;for(t.kind="scalar",t.result="",t.position++,n=i=t.position;0!==(a=t.input.charCodeAt(t.position));){if(34===a)return bt(t,n,t.position,!0),t.position++,!0;if(92===a){if(bt(t,n,t.position,!0),st(a=t.input.charCodeAt(++t.position)))At(t,!1,e);else if(a<256&&ht[a])t.result+=ft[a],t.position++;else if((o=120===(c=a)?2:117===c?4:85===c?8:0)>0){for(r=o,s=0;r>0;r--)(o=lt(a=t.input.charCodeAt(++t.position)))>=0?s=(s<<4)+o:yt(t,"expected hexadecimal character");t.result+=dt(s),t.position++}else yt(t,"unknown escape sequence");n=i=t.position}else st(a)?(bt(t,n,i,!0),Ct(t,At(t,!1,e)),n=i=t.position):t.position===t.lineStart&&St(t)?yt(t,"unexpected end of the document within a double quoted scalar"):(t.position++,i=t.position)}yt(t,"unexpected end of the stream within a double quoted scalar")}(t,f)?y=!0:!function(t){var e,n,i;if(42!==(i=t.input.charCodeAt(t.position)))return!1;for(i=t.input.charCodeAt(++t.position),e=t.position;0!==i&&!at(i)&&!ct(i);)i=t.input.charCodeAt(++t.position);return t.position===e&&yt(t,"name of an alias node must contain at least one character"),n=t.input.slice(e,t.position),q.call(t.anchorMap,n)||yt(t,'unidentified alias "'+n+'"'),t.result=t.anchorMap[n],At(t,!0,-1),!0}(t)?function(t,e,n){var i,r,s,o,a,c,l,u,d=t.kind,h=t.result;if(at(u=t.input.charCodeAt(t.position))||ct(u)||35===u||38===u||42===u||33===u||124===u||62===u||39===u||34===u||37===u||64===u||96===u)return!1;if((63===u||45===u)&&(at(i=t.input.charCodeAt(t.position+1))||n&&ct(i)))return!1;for(t.kind="scalar",t.result="",r=s=t.position,o=!1;0!==u;){if(58===u){if(at(i=t.input.charCodeAt(t.position+1))||n&&ct(i))break}else if(35===u){if(at(t.input.charCodeAt(t.position-1)))break}else{if(t.position===t.lineStart&&St(t)||n&&ct(u))break;if(st(u)){if(a=t.line,c=t.lineStart,l=t.lineIndent,At(t,!1,-1),t.lineIndent>=e){o=!0,u=t.input.charCodeAt(t.position);continue}t.position=s,t.line=a,t.lineStart=c,t.lineIndent=l;break}}o&&(bt(t,r,s,!1),Ct(t,t.line-a),r=s=t.position,o=!1),ot(u)||(s=t.position+1),u=t.input.charCodeAt(++t.position)}return bt(t,r,s,!1),!!t.result||(t.kind=d,t.result=h,!1)}(t,f,P===n)&&(y=!0,null===t.tag&&(t.tag="?")):(y=!0,null===t.tag&&null===t.anchor||yt(t,"alias node should not have any properties")),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):0===g&&(y=c&&Tt(t,p))),null===t.tag)null!==t.anchor&&(t.anchorMap[t.anchor]=t.result);else if("?"===t.tag){for(null!==t.result&&"scalar"!==t.kind&&yt(t,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+t.kind+'"'),l=0,u=t.implicitTypes.length;l<u;l+=1)if((h=t.implicitTypes[l]).resolve(t.result)){t.result=h.construct(t.result),t.tag=h.tag,null!==t.anchor&&(t.anchorMap[t.anchor]=t.result);break}}else if("!"!==t.tag){if(q.call(t.typeMap[t.kind||"fallback"],t.tag))h=t.typeMap[t.kind||"fallback"][t.tag];else for(h=null,l=0,u=(d=t.typeMap.multi[t.kind||"fallback"]).length;l<u;l+=1)if(t.tag.slice(0,d[l].tag.length)===d[l].tag){h=d[l];break}h||yt(t,"unknown tag !<"+t.tag+">"),null!==t.result&&h.kind!==t.kind&&yt(t,"unacceptable node kind for !<"+t.tag+'> tag; it should be "'+h.kind+'", not "'+t.kind+'"'),h.resolve(t.result,t.tag)?(t.result=h.construct(t.result,t.tag),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):yt(t,"cannot resolve a node with !<"+t.tag+"> explicit tag")}return null!==t.listener&&t.listener("close",t),null!==t.tag||null!==t.anchor||y}function jt(t){var e,n,i,r,s=t.position,o=!1;for(t.version=null,t.checkLineBreaks=t.legacy,t.tagMap=Object.create(null),t.anchorMap=Object.create(null);0!==(r=t.input.charCodeAt(t.position))&&(At(t,!0,-1),r=t.input.charCodeAt(t.position),!(t.lineIndent>0||37!==r));){for(o=!0,r=t.input.charCodeAt(++t.position),e=t.position;0!==r&&!at(r);)r=t.input.charCodeAt(++t.position);for(i=[],(n=t.input.slice(e,t.position)).length<1&&yt(t,"directive name must not be less than one character in length");0!==r;){for(;ot(r);)r=t.input.charCodeAt(++t.position);if(35===r){do{r=t.input.charCodeAt(++t.position)}while(0!==r&&!st(r));break}if(st(r))break;for(e=t.position;0!==r&&!at(r);)r=t.input.charCodeAt(++t.position);i.push(t.input.slice(e,t.position))}0!==r&&Et(t),q.call(vt,n)?vt[n](t,n,i):_t(t,'unknown document directive "'+n+'"')}At(t,!0,-1),0===t.lineIndent&&45===t.input.charCodeAt(t.position)&&45===t.input.charCodeAt(t.position+1)&&45===t.input.charCodeAt(t.position+2)?(t.position+=3,At(t,!0,-1)):o&&yt(t,"directives end mark is expected"),It(t,t.lineIndent-1,H,!1,!0),At(t,!0,-1),t.checkLineBreaks&&tt.test(t.input.slice(s,t.position))&&_t(t,"non-ASCII line breaks are interpreted as content"),t.documents.push(t.result),t.position===t.lineStart&&St(t)?46===t.input.charCodeAt(t.position)&&(t.position+=3,At(t,!0,-1)):t.position<t.length-1&&yt(t,"end of the stream or a document separator is expected")}function Nt(t,e){e=e||{},0!==(t=String(t)).length&&(10!==t.charCodeAt(t.length-1)&&13!==t.charCodeAt(t.length-1)&&(t+="\n"),65279===t.charCodeAt(0)&&(t=t.slice(1)));var n=new gt(t,e),i=t.indexOf("\0");for(-1!==i&&(n.position=i,yt(n,"null byte is not allowed in input")),n.input+="\0";32===n.input.charCodeAt(n.position);)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)jt(n);return n.documents}var Ft={loadAll:function(t,e,n){null!==e&&"object"==typeof e&&void 0===n&&(n=e,e=null);var i=Nt(t,n);if("function"!=typeof e)return i;for(var r=0,s=i.length;r<s;r+=1)e(i[r])},load:function(t,e){var n=Nt(t,e);if(0!==n.length){if(1===n.length)return n[0];throw new a("expected a single document in the stream, but found more")}}},Mt=Object.prototype.toString,Rt=Object.prototype.hasOwnProperty,Lt=65279,Dt=9,Bt=10,zt=13,Kt=32,Gt=33,Vt=34,Ut=35,$t=37,qt=38,Pt=39,Jt=42,Wt=44,Ht=45,Yt=58,Xt=61,Qt=62,Zt=63,te=64,ee=91,ne=93,ie=96,re=123,se=124,oe=125,ae={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},ce=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],le=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function ue(t){var e,n,i;if(e=t.toString(16).toUpperCase(),t<=255)n="x",i=2;else if(t<=65535)n="u",i=4;else{if(!(t<=4294967295))throw new a("code point within a string may not be greater than 0xFFFFFFFF");n="U",i=8}return"\\"+n+r.repeat("0",i-e.length)+e}var de=1,he=2;function fe(t){this.schema=t.schema||$,this.indent=Math.max(1,t.indent||2),this.noArrayIndent=t.noArrayIndent||!1,this.skipInvalid=t.skipInvalid||!1,this.flowLevel=r.isNothing(t.flowLevel)?-1:t.flowLevel,this.styleMap=function(t,e){var n,i,r,s,o,a,c;if(null===e)return{};for(n={},r=0,s=(i=Object.keys(e)).length;r<s;r+=1)o=i[r],a=String(e[o]),"!!"===o.slice(0,2)&&(o="tag:yaml.org,2002:"+o.slice(2)),(c=t.compiledTypeMap.fallback[o])&&Rt.call(c.styleAliases,a)&&(a=c.styleAliases[a]),n[o]=a;return n}(this.schema,t.styles||null),this.sortKeys=t.sortKeys||!1,this.lineWidth=t.lineWidth||80,this.noRefs=t.noRefs||!1,this.noCompatMode=t.noCompatMode||!1,this.condenseFlow=t.condenseFlow||!1,this.quotingType='"'===t.quotingType?he:de,this.forceQuotes=t.forceQuotes||!1,this.replacer="function"==typeof t.replacer?t.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function pe(t,e){for(var n,i=r.repeat(" ",e),s=0,o=-1,a="",c=t.length;s<c;)-1===(o=t.indexOf("\n",s))?(n=t.slice(s),s=c):(n=t.slice(s,o+1),s=o+1),n.length&&"\n"!==n&&(a+=i),a+=n;return a}function ge(t,e){return"\n"+r.repeat(" ",t.indent*e)}function me(t){return t===Kt||t===Dt}function ye(t){return 32<=t&&t<=126||161<=t&&t<=55295&&8232!==t&&8233!==t||57344<=t&&t<=65533&&t!==Lt||65536<=t&&t<=1114111}function _e(t){return ye(t)&&t!==Lt&&t!==zt&&t!==Bt}function ve(t,e,n){var i=_e(t),r=i&&!me(t);return(n?i:i&&t!==Wt&&t!==ee&&t!==ne&&t!==re&&t!==oe)&&t!==Ut&&!(e===Yt&&!r)||_e(e)&&!me(e)&&t===Ut||e===Yt&&r}function be(t,e){var n,i=t.charCodeAt(e);return i>=55296&&i<=56319&&e+1<t.length&&(n=t.charCodeAt(e+1))>=56320&&n<=57343?1024*(i-55296)+n-56320+65536:i}function we(t){return/^\n* /.test(t)}var xe=1,Ee=2,Ae=3,Se=4,Ce=5;function Te(t,e,n,i,r,s,o,a){var c,l,u=0,d=null,h=!1,f=!1,p=-1!==i,g=-1,m=ye(l=be(t,0))&&l!==Lt&&!me(l)&&l!==Ht&&l!==Zt&&l!==Yt&&l!==Wt&&l!==ee&&l!==ne&&l!==re&&l!==oe&&l!==Ut&&l!==qt&&l!==Jt&&l!==Gt&&l!==se&&l!==Xt&&l!==Qt&&l!==Pt&&l!==Vt&&l!==$t&&l!==te&&l!==ie&&function(t){return!me(t)&&t!==Yt}(be(t,t.length-1));if(e||o)for(c=0;c<t.length;u>=65536?c+=2:c++){if(!ye(u=be(t,c)))return Ce;m=m&&ve(u,d,a),d=u}else{for(c=0;c<t.length;u>=65536?c+=2:c++){if((u=be(t,c))===Bt)h=!0,p&&(f=f||c-g-1>i&&" "!==t[g+1],g=c);else if(!ye(u))return Ce;m=m&&ve(u,d,a),d=u}f=f||p&&c-g-1>i&&" "!==t[g+1]}return h||f?n>9&&we(t)?Ce:o?s===he?Ce:Ee:f?Se:Ae:!m||o||r(t)?s===he?Ce:Ee:xe}function ke(t,e,n,i,r){t.dump=function(){if(0===e.length)return t.quotingType===he?'""':"''";if(!t.noCompatMode&&(-1!==ce.indexOf(e)||le.test(e)))return t.quotingType===he?'"'+e+'"':"'"+e+"'";var s=t.indent*Math.max(1,n),o=-1===t.lineWidth?-1:Math.max(Math.min(t.lineWidth,40),t.lineWidth-s),c=i||t.flowLevel>-1&&n>=t.flowLevel;switch(Te(e,c,t.indent,o,(function(e){return function(t,e){var n,i;for(n=0,i=t.implicitTypes.length;n<i;n+=1)if(t.implicitTypes[n].resolve(e))return!0;return!1}(t,e)}),t.quotingType,t.forceQuotes&&!i,r)){case xe:return e;case Ee:return"'"+e.replace(/'/g,"''")+"'";case Ae:return"|"+Oe(e,t.indent)+Ie(pe(e,s));case Se:return">"+Oe(e,t.indent)+Ie(pe(function(t,e){var n,i,r=/(\n+)([^\n]*)/g,s=(a=t.indexOf("\n"),a=-1!==a?a:t.length,r.lastIndex=a,je(t.slice(0,a),e)),o="\n"===t[0]||" "===t[0];var a;for(;i=r.exec(t);){var c=i[1],l=i[2];n=" "===l[0],s+=c+(o||n||""===l?"":"\n")+je(l,e),o=n}return s}(e,o),s));case Ce:return'"'+function(t){for(var e,n="",i=0,r=0;r<t.length;i>=65536?r+=2:r++)i=be(t,r),!(e=ae[i])&&ye(i)?(n+=t[r],i>=65536&&(n+=t[r+1])):n+=e||ue(i);return n}(e)+'"';default:throw new a("impossible error: invalid scalar style")}}()}function Oe(t,e){var n=we(t)?String(e):"",i="\n"===t[t.length-1];return n+(i&&("\n"===t[t.length-2]||"\n"===t)?"+":i?"":"-")+"\n"}function Ie(t){return"\n"===t[t.length-1]?t.slice(0,-1):t}function je(t,e){if(""===t||" "===t[0])return t;for(var n,i,r=/ [^ ]/g,s=0,o=0,a=0,c="";n=r.exec(t);)(a=n.index)-s>e&&(i=o>s?o:a,c+="\n"+t.slice(s,i),s=i+1),o=a;return c+="\n",t.length-s>e&&o>s?c+=t.slice(s,o)+"\n"+t.slice(o+1):c+=t.slice(s),c.slice(1)}function Ne(t,e,n,i){var r,s,o,a="",c=t.tag;for(r=0,s=n.length;r<s;r+=1)o=n[r],t.replacer&&(o=t.replacer.call(n,String(r),o)),(Me(t,e+1,o,!0,!0,!1,!0)||void 0===o&&Me(t,e+1,null,!0,!0,!1,!0))&&(i&&""===a||(a+=ge(t,e)),t.dump&&Bt===t.dump.charCodeAt(0)?a+="-":a+="- ",a+=t.dump);t.tag=c,t.dump=a||"[]"}function Fe(t,e,n){var i,r,s,o,c,l;for(s=0,o=(r=n?t.explicitTypes:t.implicitTypes).length;s<o;s+=1)if(((c=r[s]).instanceOf||c.predicate)&&(!c.instanceOf||"object"==typeof e&&e instanceof c.instanceOf)&&(!c.predicate||c.predicate(e))){if(n?c.multi&&c.representName?t.tag=c.representName(e):t.tag=c.tag:t.tag="?",c.represent){if(l=t.styleMap[c.tag]||c.defaultStyle,"[object Function]"===Mt.call(c.represent))i=c.represent(e,l);else{if(!Rt.call(c.represent,l))throw new a("!<"+c.tag+'> tag resolver accepts not "'+l+'" style');i=c.represent[l](e,l)}t.dump=i}return!0}return!1}function Me(t,e,n,i,r,s,o){t.tag=null,t.dump=n,Fe(t,n,!1)||Fe(t,n,!0);var c,l=Mt.call(t.dump),u=i;i&&(i=t.flowLevel<0||t.flowLevel>e);var d,h,f="[object Object]"===l||"[object Array]"===l;if(f&&(h=-1!==(d=t.duplicates.indexOf(n))),(null!==t.tag&&"?"!==t.tag||h||2!==t.indent&&e>0)&&(r=!1),h&&t.usedDuplicates[d])t.dump="*ref_"+d;else{if(f&&h&&!t.usedDuplicates[d]&&(t.usedDuplicates[d]=!0),"[object Object]"===l)i&&0!==Object.keys(t.dump).length?(!function(t,e,n,i){var r,s,o,c,l,u,d="",h=t.tag,f=Object.keys(n);if(!0===t.sortKeys)f.sort();else if("function"==typeof t.sortKeys)f.sort(t.sortKeys);else if(t.sortKeys)throw new a("sortKeys must be a boolean or a function");for(r=0,s=f.length;r<s;r+=1)u="",i&&""===d||(u+=ge(t,e)),c=n[o=f[r]],t.replacer&&(c=t.replacer.call(n,o,c)),Me(t,e+1,o,!0,!0,!0)&&((l=null!==t.tag&&"?"!==t.tag||t.dump&&t.dump.length>1024)&&(t.dump&&Bt===t.dump.charCodeAt(0)?u+="?":u+="? "),u+=t.dump,l&&(u+=ge(t,e)),Me(t,e+1,c,!0,l)&&(t.dump&&Bt===t.dump.charCodeAt(0)?u+=":":u+=": ",d+=u+=t.dump));t.tag=h,t.dump=d||"{}"}(t,e,t.dump,r),h&&(t.dump="&ref_"+d+t.dump)):(!function(t,e,n){var i,r,s,o,a,c="",l=t.tag,u=Object.keys(n);for(i=0,r=u.length;i<r;i+=1)a="",""!==c&&(a+=", "),t.condenseFlow&&(a+='"'),o=n[s=u[i]],t.replacer&&(o=t.replacer.call(n,s,o)),Me(t,e,s,!1,!1)&&(t.dump.length>1024&&(a+="? "),a+=t.dump+(t.condenseFlow?'"':"")+":"+(t.condenseFlow?"":" "),Me(t,e,o,!1,!1)&&(c+=a+=t.dump));t.tag=l,t.dump="{"+c+"}"}(t,e,t.dump),h&&(t.dump="&ref_"+d+" "+t.dump));else if("[object Array]"===l)i&&0!==t.dump.length?(t.noArrayIndent&&!o&&e>0?Ne(t,e-1,t.dump,r):Ne(t,e,t.dump,r),h&&(t.dump="&ref_"+d+t.dump)):(!function(t,e,n){var i,r,s,o="",a=t.tag;for(i=0,r=n.length;i<r;i+=1)s=n[i],t.replacer&&(s=t.replacer.call(n,String(i),s)),(Me(t,e,s,!1,!1)||void 0===s&&Me(t,e,null,!1,!1))&&(""!==o&&(o+=","+(t.condenseFlow?"":" ")),o+=t.dump);t.tag=a,t.dump="["+o+"]"}(t,e,t.dump),h&&(t.dump="&ref_"+d+" "+t.dump));else{if("[object String]"!==l){if("[object Undefined]"===l)return!1;if(t.skipInvalid)return!1;throw new a("unacceptable kind of an object to dump "+l)}"?"!==t.tag&&ke(t,t.dump,e,s,u)}null!==t.tag&&"?"!==t.tag&&(c=encodeURI("!"===t.tag[0]?t.tag.slice(1):t.tag).replace(/!/g,"%21"),c="!"===t.tag[0]?"!"+c:"tag:yaml.org,2002:"===c.slice(0,18)?"!!"+c.slice(18):"!<"+c+">",t.dump=c+" "+t.dump)}return!0}function Re(t,e){var n,i,r=[],s=[];for(Le(t,r,s),n=0,i=s.length;n<i;n+=1)e.duplicates.push(r[s[n]]);e.usedDuplicates=new Array(i)}function Le(t,e,n){var i,r,s;if(null!==t&&"object"==typeof t)if(-1!==(r=e.indexOf(t)))-1===n.indexOf(r)&&n.push(r);else if(e.push(t),Array.isArray(t))for(r=0,s=t.length;r<s;r+=1)Le(t[r],e,n);else for(r=0,s=(i=Object.keys(t)).length;r<s;r+=1)Le(t[i[r]],e,n)}function De(t,e){return function(){throw new Error("Function yaml."+t+" is removed in js-yaml 4. Use yaml."+e+" instead, which is now safe by default.")}}var Be=f,ze=m,Ke=b,Ge=O,Ve=I,Ue=$,$e=Ft.load,qe=Ft.loadAll,Pe={dump:function(t,e){var n=new fe(e=e||{});n.noRefs||Re(t,n);var i=t;return n.replacer&&(i=n.replacer.call({"":i},"",i)),Me(n,0,i,!0,!0)?n.dump+"\n":""}}.dump,Je=a,We={binary:L,float:k,map:v,null:w,pairs:G,set:U,timestamp:F,bool:x,int:S,merge:M,omap:z,seq:_,str:y},He=De("safeLoad","load"),Ye=De("safeLoadAll","loadAll"),Xe=De("safeDump","dump");const Qe={Type:Be,Schema:ze,FAILSAFE_SCHEMA:Ke,JSON_SCHEMA:Ge,CORE_SCHEMA:Ve,DEFAULT_SCHEMA:Ue,load:$e,loadAll:qe,dump:Pe,YAMLException:Je,types:We,safeLoad:He,safeLoadAll:Ye,safeDump:Xe}},"./node_modules/query-string/base.js":(t,e,n)=>{"use strict";n.r(e),n.d(e,{exclude:()=>w,extract:()=>g,parse:()=>m,parseUrl:()=>_,pick:()=>b,stringify:()=>y,stringifyUrl:()=>v});var i=n("./node_modules/decode-uri-component/index.js"),r=n("./node_modules/split-on-first/index.js"),s=n("./node_modules/filter-obj/index.js");const o=t=>null==t,a=t=>encodeURIComponent(t).replace(/[!'()*]/g,(t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`)),c=Symbol("encodeFragmentIdentifier");function l(t){if("string"!=typeof t||1!==t.length)throw new TypeError("arrayFormatSeparator must be single character string")}function u(t,e){return e.encode?e.strict?a(t):encodeURIComponent(t):t}function d(t,e){return e.decode?(0,i.default)(t):t}function h(t){return Array.isArray(t)?t.sort():"object"==typeof t?h(Object.keys(t)).sort(((t,e)=>Number(t)-Number(e))).map((e=>t[e])):t}function f(t){const e=t.indexOf("#");return-1!==e&&(t=t.slice(0,e)),t}function p(t,e){return e.parseNumbers&&!Number.isNaN(Number(t))&&"string"==typeof t&&""!==t.trim()?t=Number(t):!e.parseBooleans||null===t||"true"!==t.toLowerCase()&&"false"!==t.toLowerCase()||(t="true"===t.toLowerCase()),t}function g(t){const e=(t=f(t)).indexOf("?");return-1===e?"":t.slice(e+1)}function m(t,e){l((e={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,...e}).arrayFormatSeparator);const n=function(t){let e;switch(t.arrayFormat){case"index":return(t,n,i)=>{e=/\[(\d*)]$/.exec(t),t=t.replace(/\[\d*]$/,""),e?(void 0===i[t]&&(i[t]={}),i[t][e[1]]=n):i[t]=n};case"bracket":return(t,n,i)=>{e=/(\[])$/.exec(t),t=t.replace(/\[]$/,""),e?void 0!==i[t]?i[t]=[...i[t],n]:i[t]=[n]:i[t]=n};case"colon-list-separator":return(t,n,i)=>{e=/(:list)$/.exec(t),t=t.replace(/:list$/,""),e?void 0!==i[t]?i[t]=[...i[t],n]:i[t]=[n]:i[t]=n};case"comma":case"separator":return(e,n,i)=>{const r="string"==typeof n&&n.includes(t.arrayFormatSeparator),s="string"==typeof n&&!r&&d(n,t).includes(t.arrayFormatSeparator);n=s?d(n,t):n;const o=r||s?n.split(t.arrayFormatSeparator).map((e=>d(e,t))):null===n?n:d(n,t);i[e]=o};case"bracket-separator":return(e,n,i)=>{const r=/(\[])$/.test(e);if(e=e.replace(/\[]$/,""),!r)return void(i[e]=n?d(n,t):n);const s=null===n?[]:n.split(t.arrayFormatSeparator).map((e=>d(e,t)));void 0!==i[e]?i[e]=[...i[e],...s]:i[e]=s};default:return(t,e,n)=>{void 0!==n[t]?n[t]=[...[n[t]].flat(),e]:n[t]=e}}}(e),i=Object.create(null);if("string"!=typeof t)return i;if(!(t=t.trim().replace(/^[?#&]/,"")))return i;for(const s of t.split("&")){if(""===s)continue;const t=e.decode?s.replace(/\+/g," "):s;let[o,a]=(0,r.default)(t,"=");void 0===o&&(o=t),a=void 0===a?null:["comma","separator","bracket-separator"].includes(e.arrayFormat)?a:d(a,e),n(d(o,e),a,i)}for(const[t,n]of Object.entries(i))if("object"==typeof n&&null!==n)for(const[t,i]of Object.entries(n))n[t]=p(i,e);else i[t]=p(n,e);return!1===e.sort?i:(!0===e.sort?Object.keys(i).sort():Object.keys(i).sort(e.sort)).reduce(((t,e)=>{const n=i[e];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?t[e]=h(n):t[e]=n,t}),Object.create(null))}function y(t,e){if(!t)return"";l((e={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...e}).arrayFormatSeparator);const n=n=>e.skipNull&&o(t[n])||e.skipEmptyString&&""===t[n],i=function(t){switch(t.arrayFormat){case"index":return e=>(n,i)=>{const r=n.length;return void 0===i||t.skipNull&&null===i||t.skipEmptyString&&""===i?n:null===i?[...n,[u(e,t),"[",r,"]"].join("")]:[...n,[u(e,t),"[",u(r,t),"]=",u(i,t)].join("")]};case"bracket":return e=>(n,i)=>void 0===i||t.skipNull&&null===i||t.skipEmptyString&&""===i?n:null===i?[...n,[u(e,t),"[]"].join("")]:[...n,[u(e,t),"[]=",u(i,t)].join("")];case"colon-list-separator":return e=>(n,i)=>void 0===i||t.skipNull&&null===i||t.skipEmptyString&&""===i?n:null===i?[...n,[u(e,t),":list="].join("")]:[...n,[u(e,t),":list=",u(i,t)].join("")];case"comma":case"separator":case"bracket-separator":{const e="bracket-separator"===t.arrayFormat?"[]=":"=";return n=>(i,r)=>void 0===r||t.skipNull&&null===r||t.skipEmptyString&&""===r?i:(r=null===r?"":r,0===i.length?[[u(n,t),e,u(r,t)].join("")]:[[i,u(r,t)].join(t.arrayFormatSeparator)])}default:return e=>(n,i)=>void 0===i||t.skipNull&&null===i||t.skipEmptyString&&""===i?n:null===i?[...n,u(e,t)]:[...n,[u(e,t),"=",u(i,t)].join("")]}}(e),r={};for(const[e,i]of Object.entries(t))n(e)||(r[e]=i);const s=Object.keys(r);return!1!==e.sort&&s.sort(e.sort),s.map((n=>{const r=t[n];return void 0===r?"":null===r?u(n,e):Array.isArray(r)?0===r.length&&"bracket-separator"===e.arrayFormat?u(n,e)+"[]":r.reduce(i(n),[]).join("&"):u(n,e)+"="+u(r,e)})).filter((t=>t.length>0)).join("&")}function _(t,e){e={decode:!0,...e};let[n,i]=(0,r.default)(t,"#");return void 0===n&&(n=t),{url:n?.split("?")?.[0]??"",query:m(g(t),e),...e&&e.parseFragmentIdentifier&&i?{fragmentIdentifier:d(i,e)}:{}}}function v(t,e){e={encode:!0,strict:!0,[c]:!0,...e};const n=f(t.url).split("?")[0]||"";let i=y({...m(g(t.url),{sort:!1}),...t.query},e);i&&(i=`?${i}`);let r=function(t){let e="";const n=t.indexOf("#");return-1!==n&&(e=t.slice(n)),e}(t.url);if(t.fragmentIdentifier){const i=new URL(n);i.hash=t.fragmentIdentifier,r=e[c]?i.hash:`#${t.fragmentIdentifier}`}return`${n}${i}${r}`}function b(t,e,n){n={parseFragmentIdentifier:!0,[c]:!1,...n};const{url:i,query:r,fragmentIdentifier:o}=_(t,n);return v({url:i,query:(0,s.includeKeys)(r,e),fragmentIdentifier:o},n)}function w(t,e,n){return b(t,Array.isArray(e)?t=>!e.includes(t):(t,n)=>!e(t,n),n)}},"./node_modules/query-string/index.js":(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});const i=n("./node_modules/query-string/base.js")},"./node_modules/split-on-first/index.js":(t,e,n)=>{"use strict";function i(t,e){if("string"!=typeof t||"string"!=typeof e)throw new TypeError("Expected the arguments to be of type `string`");if(""===t||""===e)return[];const n=t.indexOf(e);return-1===n?[]:[t.slice(0,n),t.slice(n+e.length)]}n.r(e),n.d(e,{default:()=>i})}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var s=e[i]={id:i,loaded:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var i={};(()=>{"use strict";n.r(i);var t,e=n("./node_modules/js-yaml/dist/js-yaml.mjs"),r=n("./node_modules/query-string/index.js"),s=n("./src/gui/guiGame.ts"),o=n("./src/i18n/localization.ts"),a=n("./src/gameEngine.ts"),c=n("./src/gui/textEngine.ts"),l=n("./src/utils/network.ts"),u=n("./src/utils/collection.ts"),d=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))};let h={},f=null===(t=document.getElementById("app_config"))||void 0===t?void 0:t.textContent;f&&(h=Object.assign({},JSON.parse(f)));let p=r.default.parse(window.location.hash||"").init_seed;"string"==typeof p&&(h.initialRandomSeed=p);new class{constructor(t,e){this._started=!1,this._config=e,this._container=t,this._actionProxy=new a.GameActionProxy,this._gameEngine=new a.GameEngine(e,this._actionProxy),this._localizer=new o.LocalizationDictionary}start(){return d(this,void 0,void 0,(function*(){if(this._started)throw new Error("App already started!");this._config.languageFileUrl?yield this._localizer.loadFrom(this._config.languageFileUrl):console.warn("Missing language file!");const t=new c.SimpleGameTextEngine(this._localizer,this._gameEngine.variableStore,this._gameEngine.random);if(!this._config.guiDefinitionUrl)throw new Error("Missing GUI config file!");let n=yield(0,l.downloadAndParse)(this._config.guiDefinitionUrl,e.load),i=new s.GuiGameWindow(this._container,t,this._gameEngine,n);this._actionProxy.attachGui(i),this._gameEngine.onGameEnd=(t,e)=>{window.dispatchEvent(new CustomEvent("gameEnd",{detail:{state:e.state,endingType:e.endingType}}))},yield this._gameEngine.start(!1),this._config.debugConfig&&this._dumpDebugInfo(this._config.debugConfig);const r=()=>{setTimeout((()=>this._gameEngine.tick().then(r)),50)};r(),this._started=!0}))}_dumpDebugInfo(t){if(t.dumpTranslationKeys){const t=this._gameEngine.eventEngine.getEvents(),e=new u.SetBuilder;for(let n of t)e.addAll(n.collectTranslationKeys());this._gameEngine.itemRegistry.forEach((t=>{this._localizer.addRequiredKey(t.unlocalizedName),this._localizer.addRequiredKey(t.unlocalizedDescription)})),this._gameEngine.statusRegistry.forEach((t=>{this._localizer.addRequiredKey(t.unlocalizedName),this._localizer.addRequiredKey(t.unlocalizedDescription)})),e.get().forEach((t=>this._localizer.addRequiredKey(t)));const n=this._localizer.dumpRequiredTranslationKeys();console.log(`# Required translation keys (${n.length}):\n${n.join("\n")}`);const i=this._localizer.dumpMissingTranslationKeys();console.log(`# Missing translation keys (${i.length}):\n${i.join("\n")}`);const r=this._localizer.dumpUnnecessaryTranslationKeys();console.log(`# Unnecessary translation keys (${r.length}):\n${r.join("\n")}`)}}}(document.body,h).start().then((()=>{console.log("App started successfully.")}))})()})();
//# sourceMappingURL=app.bundle.js.map